<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Model • brms.mmrm</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Model">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">brms.mmrm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Usage</h6></li>
    <li><a class="dropdown-item" href="../articles/usage.html">Usage</a></li>
    <li><a class="dropdown-item" href="../articles/subgroup.html">Subgroup analysis</a></li>
    <li><a class="dropdown-item" href="../articles/simulation.html">Simulation</a></li>
    <li><a class="dropdown-item" href="../articles/archetypes.html">Informative prior archetypes</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Validation</h6></li>
    <li><a class="dropdown-item" href="../articles/sbc.html">Simulation-based calibration checking</a></li>
    <li><a class="dropdown-item" href="../articles/fev1.html">FEV1 data comparison between Bayesian and frequentist MMRMs</a></li>
    <li><a class="dropdown-item" href="../articles/bcva.html">BCVA data comparison between Bayesian and frequentist MMRMs</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/openpharma/brms.mmrm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Model</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/openpharma/brms.mmrm/blob/main/vignettes/model.Rmd" class="external-link"><code>vignettes/model.Rmd</code></a></small>
      <div class="d-none name"><code>model.Rmd</code></div>
    </div>

    
    
<p>The <code>brms.mmrm</code> R package implements a mixed model of
repeated measures (MMRM), a popular and flexible model to analyze
continuous longitudinal outcomes (<span class="citation">Mallinckrodt et
al. (2008)</span>, <span class="citation">Mallinckrodt and Lipkovich
(2017)</span>, <span class="citation">Holzhauer and Weber
(2024)</span>). <code>brms.mmrm</code> focuses on marginal MMRMs for
randomized controlled parallel studies with discrete time points, where
each patient shares the same set of time points. Whereas the <a href="https://openpharma.github.io/mmrm/" class="external-link"><code>mmrm</code></a> package
is frequentist, <code>brms.mmrm</code> fits models in Bayesian fashion
using <a href="https://paulbuerkner.com/brms/" class="external-link"><code>brms</code></a>
<span class="citation">(Bürkner 2017)</span>.</p>
<div class="section level2">
<h2 id="model">Model<a class="anchor" aria-label="anchor" href="#model"></a>
</h2>
<p>Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>y</mi><mi>N</mi></msub></mrow><annotation encoding="application/x-tex">y_1, \ldots, y_N</annotation></semantics></math>
be independent data points observed for individual patients in a
clinical trial. Each
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mi>n</mi></msub><annotation encoding="application/x-tex">y_n</annotation></semantics></math>
is a numeric vector of length
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math>
is the number of discrete time points in the dataset (e.g. patient
visits in the study protocol). We model
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mi>n</mi></msub><annotation encoding="application/x-tex">y_n</annotation></semantics></math>
as follows:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>y</mi><mi>n</mi></msub><mo>∼</mo><mtext mathvariant="normal">Multivariate-Normal</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">mean</mtext><mo>=</mo><msub><mi>X</mi><mi>n</mi></msub><mi>b</mi><mo>,</mo><mspace width="0.222em"></mspace><mtext mathvariant="normal">variance</mtext><mo>=</mo><msub><mi>Σ</mi><mi>n</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
y_n \sim \text{Multivariate-Normal}\left ( \text{mean} = X_n b, \ \text{variance} = \Sigma_n \right )
\end{aligned}
</annotation></semantics></math> Above,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mi>n</mi></msub><annotation encoding="application/x-tex">X_n</annotation></semantics></math>
is the fixed effect model matrix of patient
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>,
and its specific makeup is determined by arguments such as
<code>intercept</code> and <code>group</code> in
<code><a href="../reference/brm_formula.html">brm_formula()</a></code>.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>b</mi><annotation encoding="application/x-tex">b</annotation></semantics></math>
is a constant-length vector of fixed effect parameters.</p>
<p>The MMRM in <code>brms.mmrm</code> is a <a href="https://paulbuerkner.com/brms/articles/brms_distreg.html" class="external-link">distributional
model</a>, which means it uses a linear regression structure for both
the mean and the variance of the multivariate normal likelihood. In
particular, the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo>×</mo><mi>T</mi></mrow><annotation encoding="application/x-tex">T \times T</annotation></semantics></math>
symmetric positive-definite residual covariance matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Σ</mi><mi>n</mi></msub><annotation encoding="application/x-tex">\Sigma_n</annotation></semantics></math>
of patient
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
decomposes as follows:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>Σ</mi><mi>n</mi></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mtext mathvariant="normal">diag</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>σ</mi><mi>n</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>⋅</mo><mi>Λ</mi><mo>⋅</mo><mtext mathvariant="normal">diag</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>σ</mi><mi>n</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>σ</mi><mi>n</mi></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mtext mathvariant="normal">exp</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Z</mi><mi>n</mi></msub><msub><mi>b</mi><mi>σ</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
\Sigma_n &amp;= \text{diag}(\sigma_n) \cdot \Lambda \cdot \text{diag}(\sigma_n) \\
\sigma_n &amp;= \text{exp} \left ( Z_n b_\sigma \right)
\end{aligned}
</annotation></semantics></math></p>
<p>Above,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>σ</mi><mi>n</mi></msub><annotation encoding="application/x-tex">\sigma_n</annotation></semantics></math>
is a vector of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math>
time-specific scalar standard deviations, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">diag</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>σ</mi><mi>n</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{diag}(\sigma_n)</annotation></semantics></math>
is a diagonal
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo>×</mo><mi>T</mi></mrow><annotation encoding="application/x-tex">T \times T</annotation></semantics></math>
matrix.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Z</mi><mi>n</mi></msub><annotation encoding="application/x-tex">Z_n</annotation></semantics></math>
is a patient-specific matrix which controls how the <a href="https://paulbuerkner.com/brms/articles/brms_distreg.html" class="external-link">distributional
parameters</a>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>b</mi><mi>σ</mi></msub><annotation encoding="application/x-tex">b_\sigma</annotation></semantics></math>
map to the more intuitive standard deviation vector
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>σ</mi><mi>n</mi></msub><annotation encoding="application/x-tex">\sigma_n</annotation></semantics></math>.
The specific makeup of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Z</mi><mi>n</mi></msub><annotation encoding="application/x-tex">Z_n</annotation></semantics></math>
is determined by the <code>sigma</code> argument of
<code><a href="../reference/brm_formula.html">brm_formula()</a></code>, which in turn is produced by
<code><a href="../reference/brm_formula_sigma.html">brm_formula_sigma()</a></code>.</p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Λ</mi><annotation encoding="application/x-tex">\Lambda</annotation></semantics></math>
is a symmetric positive-definite correlation matrix with diagonal
elements equal to 1 and off-diagonal elements between -1 and 1. The
structure of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Λ</mi><annotation encoding="application/x-tex">\Lambda</annotation></semantics></math>
depends on the <code>correlation</code> argument of
<code><a href="../reference/brm_formula.html">brm_formula()</a></code>, which could describe an unstructured
parameterization, ARMA, compound symmetry, etc. These alternative
structures and priors are available directly through <code>brms</code>.
For specific details, please consult <a href="https://paulbuerkner.com/brms/reference/autocor-terms.html" class="external-link uri">https://paulbuerkner.com/brms/reference/autocor-terms.html</a>
and <code><a href="../reference/brm_formula.html">?brms.mmrm::brm_formula</a></code>.</p>
</div>
<div class="section level2">
<h2 id="priors">Priors<a class="anchor" aria-label="anchor" href="#priors"></a>
</h2>
<p>The scalar components of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>b</mi><annotation encoding="application/x-tex">b</annotation></semantics></math>
are modeled as independent with user-defined priors specified through
the <code>prior</code> argument of <code><a href="../reference/brm_model.html">brm_model()</a></code>. The
hyperparameters of these priors are constant. The default priors are
improper uniform for non-intercept terms and a data-dependent Student-t
distribution for the intercept. The variance-related distributional
parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>b</mi><mi>σ</mi></msub><annotation encoding="application/x-tex">b_\sigma</annotation></semantics></math>
are given similar priors</p>
<p>For the correlation matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Λ</mi><annotation encoding="application/x-tex">\Lambda</annotation></semantics></math>,
the default prior in <code>brms.mmrm</code> is the <a href="https://mc-stan.org/docs/functions-reference/correlation_matrix_distributions.html#lkj-correlation" class="external-link">LKJ
correlation distribution</a> with shape parameter equal to 1. This
choice of prior is only valid for unstructured correlation matrices.
Other correlation structures, such ARMA, will parameterize
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Λ</mi><annotation encoding="application/x-tex">\Lambda</annotation></semantics></math>
and allow users to set priors on those new specialized parameters.</p>
</div>
<div class="section level2">
<h2 id="sampling">Sampling<a class="anchor" aria-label="anchor" href="#sampling"></a>
</h2>
<p><code>brms.mmrm</code>, through <a href="https://paulbuerkner.com/brms/" class="external-link"><code>brms</code></a>, fits the
model to the data using the Markov chain Monte Carlo (MCMC) capabilities
of <a href="https://mc-stan.org/" class="external-link">Stan</a> <span class="citation">(Stan
Development Team 2023)</span>. Please read <a href="https://mc-stan.org/users/documentation/" class="external-link uri">https://mc-stan.org/users/documentation/</a> for more
details on the methodology of <a href="https://mc-stan.org/" class="external-link">Stan</a>.
The result of MCMC is a collection of draws from the full joint
posterior distribution of the parameters given the data. Individual
draws of scalar parameters such as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>β</mi><mn>3</mn></msub><annotation encoding="application/x-tex">\beta_3</annotation></semantics></math>
are considered draws from the marginal posterior distribution of
e.g. <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>β</mi><mn>3</mn></msub><annotation encoding="application/x-tex">\beta_3</annotation></semantics></math>
given the data.</p>
</div>
<div class="section level2">
<h2 id="imputation-of-missing-outcomes">Imputation of missing outcomes<a class="anchor" aria-label="anchor" href="#imputation-of-missing-outcomes"></a>
</h2>
<p>Under the missing at random (MAR) assumptions, MMRMs do not require
imputation (<span class="citation">Holzhauer and Weber (2024)</span>).
However, if the outcomes in your data are not missing at random, or if
you are targeting an alternative estimand, then you may need to impute
missing outcomes. <code>brms.mmrm</code> can leverage either of the two
alternative solutions described at <a href="https://paulbuerkner.com/brms/articles/brms_missings.html" class="external-link uri">https://paulbuerkner.com/brms/articles/brms_missings.html</a>.
Please see the <a href="https://openpharma.github.io/brms.mmrm/articles/usage.html" class="external-link">usage
vignette</a> for details on the implementation and interface.</p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-burkner2017" class="csl-entry">
Bürkner, P.-C. (2017), <span>“<span class="nocase">brms</span>: An
<span>R</span> package for <span>Bayesian</span> multilevel models using
<span>Stan</span>,”</span> <em>Journal of Statistical Software</em>, 80,
1–28. <a href="https://doi.org/10.18637/jss.v080.i01" class="external-link">https://doi.org/10.18637/jss.v080.i01</a>.
</div>
<div id="ref-bamdd" class="csl-entry">
Holzhauer, B., and Weber, S. (2024), <span>“<a href="https://opensource.nibr.com/bamdd/src/02h_mmrm.html" class="external-link"><span class="nocase">Bayesian Mixed effects Model for Repeated
Measures</span></a>,”</span> in <em><span class="nocase">Applied
Modeling in Drug Development</span></em>, <span>Novartis AG</span>.
</div>
<div id="ref-mallinckrodt2008" class="csl-entry">
Mallinckrodt, C. H., Lane, P. W., Schnell, D., and others (2008),
<span>“Recommendations for the primary analysis of continuous endpoints
in longitudinal clinical trials,”</span> <em>Therapeutic Innovation and
Regulatory Science</em>, 42, 303–319. <a href="https://doi.org/10.1177/009286150804200402" class="external-link">https://doi.org/10.1177/009286150804200402</a>.
</div>
<div id="ref-mallinckrodt2017" class="csl-entry">
Mallinckrodt, C. H., and Lipkovich, I. (2017), <em>Analyzing
longitudinal clinical trial data: A practical guide</em>, CRC Press,
Taylor; Francis Group.
</div>
<div id="ref-stan2023" class="csl-entry">
Stan Development Team (2023), <em><a href="https://mc-stan.org" class="external-link">Stan
modeling language users guide and reference manual</a></em>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by William Michael Landau, Kevin Kunzmann, Yoni Sidi, Christian Stock, Eli Lilly and Company, Boehringer Ingelheim Pharma GmbH &amp; Co. KG.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
