<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Inference • brms.mmrm</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Inference">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">brms.mmrm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Usage</h6></li>
    <li><a class="dropdown-item" href="../articles/usage.html">Usage</a></li>
    <li><a class="dropdown-item" href="../articles/subgroup.html">Subgroup analysis</a></li>
    <li><a class="dropdown-item" href="../articles/simulation.html">Simulation</a></li>
    <li><a class="dropdown-item" href="../articles/archetypes.html">Informative prior archetypes</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Validation</h6></li>
    <li><a class="dropdown-item" href="../articles/sbc.html">Simulation-based calibration checking</a></li>
    <li><a class="dropdown-item" href="../articles/fev1.html">FEV1 data comparison between Bayesian and frequentist MMRMs</a></li>
    <li><a class="dropdown-item" href="../articles/bcva.html">BCVA data comparison between Bayesian and frequentist MMRMs</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/openpharma/brms.mmrm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Inference</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/openpharma/brms.mmrm/blob/main/vignettes/inference.Rmd" class="external-link"><code>vignettes/inference.Rmd</code></a></small>
      <div class="d-none name"><code>inference.Rmd</code></div>
    </div>

    
    
<p>This vignette explains how <code>brms.mmrm</code> conducts posterior
inference on a fitted <a href="https://openpharma.github.io/brms.mmrm/articles/model.html" class="external-link">MMRM
model</a> using estimated marginal means.</p>
<div class="section level2">
<h2 id="example-data">Example data<a class="anchor" aria-label="anchor" href="#example-data"></a>
</h2>
<p>Throughout this vignette, we use the <code>mmrm</code> package’s
<code>fev_data</code> dataset, a simulation of a clinical trial in which
chronic obstructive pulmonary disease (COPD) patients (variable
<code>USUBJID</code>) were randomized to different treatment groups
(variable <code>ARMCD</code>) and measured across four discrete time
points (variable <code>AVISIT</code>). The given response variable is
forced expired volume in one second (<code>FEV1</code>), and we are
interested in the <code>FEV1</code> change from baseline to each time
point (derived variable <code>FEV_CHG</code>). For this vignette, we
impute missing responses in order to simplify the discussion.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://openpharma.github.io/brms.mmrm/" class="external-link">brms.mmrm</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">fev_data</span>, package <span class="op">=</span> <span class="st">"mmrm"</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">fev_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">USUBJID</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/complete.html" class="external-link">complete</a></span><span class="op">(</span><span class="va">AVISIT</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">AVISIT</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/fill.html" class="external-link">fill</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">any_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ARMCD"</span>, <span class="st">"FEV1_BL"</span>, <span class="st">"RACE"</span>, <span class="st">"SEX"</span>, <span class="st">"WEIGHT"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    .direction <span class="op">=</span> <span class="st">"downup"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>FEV1 <span class="op">=</span> <span class="fu">na.locf</span><span class="op">(</span><span class="va">FEV1</span>, na.rm <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>FEV1 <span class="op">=</span> <span class="fu">na.locf</span><span class="op">(</span><span class="va">FEV1</span>, na.rm <span class="op">=</span> <span class="cn">FALSE</span>, fromLast <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">FEV1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>FEV1_CHG <span class="op">=</span> <span class="va">FEV1</span> <span class="op">-</span> <span class="va">FEV1_BL</span>, USUBJID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">USUBJID</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">FEV1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">USUBJID</span>, <span class="va">AVISIT</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/brm_data.html">brm_data</a></span><span class="op">(</span></span>
<span>    outcome <span class="op">=</span> <span class="st">"FEV1_CHG"</span>,</span>
<span>    baseline <span class="op">=</span> <span class="st">"FEV1_BL"</span>,</span>
<span>    group <span class="op">=</span> <span class="st">"ARMCD"</span>,</span>
<span>    patient <span class="op">=</span> <span class="st">"USUBJID"</span>,</span>
<span>    time <span class="op">=</span> <span class="st">"AVISIT"</span>,</span>
<span>    covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"RACE"</span>, <span class="st">"SEX"</span>, <span class="st">"WEIGHT"</span><span class="op">)</span>,</span>
<span>    reference_group <span class="op">=</span> <span class="st">"PBO"</span>,</span>
<span>    reference_time <span class="op">=</span> <span class="st">"VIS1"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 788 × 10</span></span></span>
<span><span class="co">#&gt;    USUBJID AVISIT ARMCD RACE        SEX   FEV1_BL WEIGHT VISITN VISITN2 FEV1_CHG</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> PT10    VIS1   PBO   Black or A… Fema…    57.7  0.795      1 -<span style="color: #BB0000;">0.394</span>    -<span style="color: #BB0000;">12.7</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> PT10    VIS2   PBO   Black or A… Fema…    57.7  0.823      2 -<span style="color: #BB0000;">0.059</span><span style="color: #BB0000; text-decoration: underline;">3</span>   -<span style="color: #BB0000;">12.7</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> PT10    VIS3   PBO   Black or A… Fema…    57.7  0.594      3  1.10     -<span style="color: #BB0000;">12.7</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> PT10    VIS4   PBO   Black or A… Fema…    57.7  0.207      4  0.763    -<span style="color: #BB0000;">12.7</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> PT100   VIS1   PBO   Black or A… Fema…    51.8  0.362      1  1.59     -<span style="color: #BB0000;">17.2</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> PT100   VIS2   PBO   Black or A… Fema…    51.8  0.404      2  0.045<span style="text-decoration: underline;">0</span>   -<span style="color: #BB0000;">12.5</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> PT100   VIS3   PBO   Black or A… Fema…    51.8  0.504      3 -<span style="color: #BB0000;">0.715</span>    -<span style="color: #BB0000;">11.2</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> PT100   VIS4   PBO   Black or A… Fema…    51.8  0.201      4  0.865    -<span style="color: #BB0000;">11.2</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> PT102   VIS1   PBO   Asian       Fema…    52.2  0.577      1 -<span style="color: #BB0000;">0.416</span>    -<span style="color: #BB0000;">16.6</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> PT102   VIS2   PBO   Asian       Fema…    52.2  0.227      2 -<span style="color: #BB0000;">0.376</span>     -<span style="color: #BB0000;">8.48</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 778 more rows</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="marginal-means-for-clinical-trials">Marginal means for clinical trials<a class="anchor" aria-label="anchor" href="#marginal-means-for-clinical-trials"></a>
</h2>
<p>According to <span class="citation">Lenth (2016)</span>, marginal
means (formerly “least-squares means”) are predictions (usually averaged
predictions) at each point in a reference grid. The reference grid
declares combinations of levels of factors of interest. In a clinical
trial with repeated measures, we are often interested in the mean
response at each combination of treatment group and discrete time point.
For our FEV1 dataset, we are interested in the mean of
<code>FEV1_CHG</code> and its standard error for each combination of
treatment group and time point.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;For a subgroup analysis where the subgroup factor is
identified in advance, we would be interested in each combination of
treatment group, subgroup level, and time point.&lt;/p&gt;"><sup>1</sup></a> In other words, we want to estimate the
mean <code>FEV1_CHG</code> for group <code>"TRT"</code> time
<code>"VIS1"</code>, the mean <code>FEV1_CHG</code> for group
<code>"TRT"</code> time <code>"VIS2"</code>, and so on.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Other quantities of interest are downstream of these
marginal means. For example, the difference between &lt;code&gt;TRT&lt;/code&gt; and
&lt;code&gt;PBO&lt;/code&gt; at time point &lt;code&gt;VIS4&lt;/code&gt;, and the difference
between &lt;code&gt;VIS4&lt;/code&gt; and &lt;code&gt;VIS4&lt;/code&gt; for the &lt;code&gt;TRT&lt;/code&gt;
group, are simple contrasts of the upstream marginal means.&lt;/p&gt;"><sup>2</sup></a> We represent our goals
in a reference with one row per marginal mean of interest and columns
with the levels of the factors of interest.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reference_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">ARMCD</span>, <span class="va">AVISIT</span><span class="op">)</span></span>
<span><span class="va">reference_grid</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 2</span></span></span>
<span><span class="co">#&gt;   ARMCD AVISIT</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> PBO   VIS1  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> PBO   VIS2  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> PBO   VIS3  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> PBO   VIS4  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> TRT   VIS1  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> TRT   VIS2  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> TRT   VIS3  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> TRT   VIS4</span></span></code></pre></div>
<p>It is seldom trivial to estimate marginal means. For example, the
following parameterization includes an intercept term, additive terms
for each level of each factor, interactions to capture non-additive
relationships among factors, continuous covariates, and different
<code>FEV1_BL</code> slopes for different time points. Here, there is no
model coefficient that directly corresponds to a marginal mean of
interest. Even terms like <code>AVISITVIS2:ARMCDTRT</code> implicitly
condition on a subset of the data because of the other variables
involved.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">brms_mmrm_formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brm_formula.html">brm_formula</a></span><span class="op">(</span><span class="va">data</span>, correlation <span class="op">=</span> <span class="st">"diagonal"</span><span class="op">)</span></span>
<span><span class="va">base_formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">as.formula</a></span><span class="op">(</span><span class="va">brms_mmrm_formula</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">base_formula</span>, <span class="st">"nl"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">base_formula</span>, <span class="st">"loop"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">base_formula</span></span>
<span><span class="co">#&gt; FEV1_CHG ~ FEV1_BL + FEV1_BL:AVISIT + ARMCD + ARMCD:AVISIT + </span></span>
<span><span class="co">#&gt;     AVISIT + RACE + SEX + WEIGHT</span></span>
<span><span class="co">#&gt; attr(,"center")</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; &lt;environment: 0x55e4bd330b80&gt;</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">base_formula</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "(Intercept)"                   "FEV1_BL"                      </span></span>
<span><span class="co">#&gt;  [3] "ARMCDTRT"                      "AVISITVIS2"                   </span></span>
<span><span class="co">#&gt;  [5] "AVISITVIS3"                    "AVISITVIS4"                   </span></span>
<span><span class="co">#&gt;  [7] "RACEBlack or African American" "RACEWhite"                    </span></span>
<span><span class="co">#&gt;  [9] "SEXFemale"                     "WEIGHT"                       </span></span>
<span><span class="co">#&gt; [11] "FEV1_BL:AVISITVIS2"            "FEV1_BL:AVISITVIS3"           </span></span>
<span><span class="co">#&gt; [13] "FEV1_BL:AVISITVIS4"            "AVISITVIS2:ARMCDTRT"          </span></span>
<span><span class="co">#&gt; [15] "AVISITVIS3:ARMCDTRT"           "AVISITVIS4:ARMCDTRT"</span></span></code></pre></div>
<p>To accomplish our goals, we need to carefully construct a linear
transformation that maps these model coefficients to the marginal means
of interest. The transformation should evaluate contrasts on the
interesting parameters and average out the uninteresting parameters.</p>
</div>
<div class="section level2">
<h2 id="existing-capabilities">Existing capabilities<a class="anchor" aria-label="anchor" href="#existing-capabilities"></a>
</h2>
<p><code><a href="../reference/brm_model.html">brms.mmrm::brm_model()</a></code> returns a fitted <a href="https://paulbuerkner.com/brms/" class="external-link"><code>brms</code></a> model, and
<a href="https://paulbuerkner.com/brms/" class="external-link"><code>brms</code></a> already
has tools for posterior inference. Through a combination of native
functions and S3 methods, <a href="https://paulbuerkner.com/brms/" class="external-link"><code>brms</code></a> integrates
not only with <a href="https://mc-stan.org/posterior/" class="external-link"><code>posterior</code></a> and <a href="https://mc-stan.org/loo/" class="external-link"><code>loo</code></a>, but also <a href="https://cran.r-project.org/package=emmeans" class="external-link"><code>emmeans</code></a>
for the estimation of marginal means and downstream contrasts.</p>
<p>Despite the existing features in <code>brms</code>,
<code>brms.mmrm</code> implements custom code to transform model
coefficients into marginal means. This is because the reference grids in
<code>emmeans</code> can only condition on factors explicitly declared
in the model formula supplied to <code>brms</code>, whereas
<code>brms.mmrm</code> needs more flexibility in order to support <a href="https://openpharma.github.io/brms.mmrm/articles/archetypes.html" class="external-link">informative
prior archetypes</a> (<span class="citation">Bedrick et al.
(1996)</span>, <span class="citation">Bedrick et al. (1997)</span>,
<span class="citation">Christensen et al. (2010)</span>, <span class="citation">Rosner et al. (2021)</span>).</p>
</div>
<div class="section level2">
<h2 id="how-brms-mmrm-estimates-marginal-means">How <code>brms.mmrm</code> estimates marginal means<a class="anchor" aria-label="anchor" href="#how-brms-mmrm-estimates-marginal-means"></a>
</h2>
<p>To estimate marginal means,
<code><a href="../reference/brm_transform_marginal.html">brms.mmrm::brm_transform_marginal()</a></code> creates a special
matrix.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">transform</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brm_transform_marginal.html">brm_transform_marginal</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, formula <span class="op">=</span> <span class="va">brms_mmrm_formula</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">transform</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  8 16</span></span>
<span><span class="va">transform</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="co">#&gt;          b_Intercept b_FEV1_BL b_ARMCDTRT b_AVISITVIS2</span></span>
<span><span class="co">#&gt; PBO|VIS1           1  40.12532          0            0</span></span>
<span><span class="co">#&gt; PBO|VIS2           1  40.12532          0            1</span></span>
<span><span class="co">#&gt; PBO|VIS3           1  40.12532          0            0</span></span>
<span><span class="co">#&gt; PBO|VIS4           1  40.12532          0            0</span></span>
<span><span class="co">#&gt; TRT|VIS1           1  40.12532          1            0</span></span>
<span><span class="co">#&gt; TRT|VIS2           1  40.12532          1            1</span></span>
<span><span class="co">#&gt; TRT|VIS3           1  40.12532          1            0</span></span>
<span><span class="co">#&gt; TRT|VIS4           1  40.12532          1            0</span></span></code></pre></div>
<p>This special matrix encodes the equations below which map model
coefficients to marginal means.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;&lt;code&gt;&lt;a href="https://rdrr.io/r/base/summary.html" class="external-link"&gt;summary()&lt;/a&gt;&lt;/code&gt; also invisibly returns a simple
character vector with the equations below.&lt;/p&gt;'><sup>3</sup></a></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">transform</span><span class="op">)</span></span>
<span><span class="co">#&gt; # This is a matrix to transform model parameters to marginal means.</span></span>
<span><span class="co">#&gt; # The following equations show the relationships between the</span></span>
<span><span class="co">#&gt; # marginal means (left-hand side) and fixed effect parameters</span></span>
<span><span class="co">#&gt; # (right-hand side).</span></span>
<span><span class="co">#&gt; # </span></span>
<span><span class="co">#&gt; #   PBO:VIS1 = b_Intercept + 40.13*b_FEV1_BL + 0.38*b_RACEBlackorAfricanAmerican + 0.27*b_RACEWhite + 0.53*b_SEXFemale + 0.52*b_WEIGHT</span></span>
<span><span class="co">#&gt; #   PBO:VIS2 = b_Intercept + 40.13*b_FEV1_BL + b_AVISITVIS2 + 0.38*b_RACEBlackorAfricanAmerican + 0.27*b_RACEWhite + 0.53*b_SEXFemale + 0.52*b_WEIGHT + 40.13*b_FEV1_BL:AVISITVIS2</span></span>
<span><span class="co">#&gt; #   PBO:VIS3 = b_Intercept + 40.13*b_FEV1_BL + b_AVISITVIS3 + 0.38*b_RACEBlackorAfricanAmerican + 0.27*b_RACEWhite + 0.53*b_SEXFemale + 0.52*b_WEIGHT + 40.13*b_FEV1_BL:AVISITVIS3</span></span>
<span><span class="co">#&gt; #   PBO:VIS4 = b_Intercept + 40.13*b_FEV1_BL + b_AVISITVIS4 + 0.38*b_RACEBlackorAfricanAmerican + 0.27*b_RACEWhite + 0.53*b_SEXFemale + 0.52*b_WEIGHT + 40.13*b_FEV1_BL:AVISITVIS4</span></span>
<span><span class="co">#&gt; #   TRT:VIS1 = b_Intercept + 40.13*b_FEV1_BL + b_ARMCDTRT + 0.38*b_RACEBlackorAfricanAmerican + 0.27*b_RACEWhite + 0.53*b_SEXFemale + 0.52*b_WEIGHT</span></span>
<span><span class="co">#&gt; #   TRT:VIS2 = b_Intercept + 40.13*b_FEV1_BL + b_ARMCDTRT + b_AVISITVIS2 + 0.38*b_RACEBlackorAfricanAmerican + 0.27*b_RACEWhite + 0.53*b_SEXFemale + 0.52*b_WEIGHT + 40.13*b_FEV1_BL:AVISITVIS2 + b_ARMCDTRT:AVISITVIS2</span></span>
<span><span class="co">#&gt; #   TRT:VIS3 = b_Intercept + 40.13*b_FEV1_BL + b_ARMCDTRT + b_AVISITVIS3 + 0.38*b_RACEBlackorAfricanAmerican + 0.27*b_RACEWhite + 0.53*b_SEXFemale + 0.52*b_WEIGHT + 40.13*b_FEV1_BL:AVISITVIS3 + b_ARMCDTRT:AVISITVIS3</span></span>
<span><span class="co">#&gt; #   TRT:VIS4 = b_Intercept + 40.13*b_FEV1_BL + b_ARMCDTRT + b_AVISITVIS4 + 0.38*b_RACEBlackorAfricanAmerican + 0.27*b_RACEWhite + 0.53*b_SEXFemale + 0.52*b_WEIGHT + 40.13*b_FEV1_BL:AVISITVIS4 + b_ARMCDTRT:AVISITVIS4</span></span></code></pre></div>
<p>Multiplying the matrix by a set of model coefficients is the same as
plugging the coefficients into the equations above. Both produce
estimates of marginal means.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">base_formula</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span><span class="va">marginals_custom</span> <span class="op">&lt;-</span> <span class="va">transform</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="va">marginals_custom</span></span>
<span><span class="co">#&gt;                [,1]</span></span>
<span><span class="co">#&gt; PBO|VIS1 -4.5998295</span></span>
<span><span class="co">#&gt; PBO|VIS2 -2.5445943</span></span>
<span><span class="co">#&gt; PBO|VIS3  0.9841880</span></span>
<span><span class="co">#&gt; PBO|VIS4  5.6013241</span></span>
<span><span class="co">#&gt; TRT|VIS1 -1.2858526</span></span>
<span><span class="co">#&gt; TRT|VIS2  0.8466639</span></span>
<span><span class="co">#&gt; TRT|VIS3  3.8011416</span></span>
<span><span class="co">#&gt; TRT|VIS4 10.0521521</span></span></code></pre></div>
<p>This technique is similar to <a href="https://cran.r-project.org/package=emmeans" class="external-link"><code>emmeans::emmeans(weights = "proportional")</code></a><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Unlike &lt;code&gt;emmeans&lt;/code&gt;, &lt;code&gt;brms.mmrm&lt;/code&gt;
completes the grid of patient visits to add rows for implicitly missing
responses. Completing the grid of patient visits ensures all patients
are represented equally when averaging over baseline covariates,
regardless of patients who drop out early.&lt;/p&gt;"><sup>4</sup></a> (<span class="citation">Lenth (2016)</span>, <span class="citation">Searle et
al. (1980)</span>) and produces similar estimates.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rvlenth.github.io/emmeans/" class="external-link">emmeans</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Welcome to emmeans.</span></span>
<span><span class="co">#&gt; Caution: You lose important information if you filter this package's results.</span></span>
<span><span class="co">#&gt; See '? untidy'</span></span>
<span><span class="va">marginals_emmeans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rvlenth.github.io/emmeans/reference/emmeans.html" class="external-link">emmeans</a></span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="va">model</span>,</span>
<span>  specs <span class="op">=</span> <span class="op">~</span><span class="va">ARMCD</span><span class="op">:</span><span class="va">AVISIT</span>,</span>
<span>  weights <span class="op">=</span> <span class="st">"proportional"</span>,</span>
<span>  nuisance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"USUBJID"</span>, <span class="st">"RACE"</span>, <span class="st">"SEX"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">ARMCD</span>, <span class="va">AVISIT</span>, <span class="va">emmean</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">ARMCD</span>, <span class="va">AVISIT</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">marginals_emmeans</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 3</span></span></span>
<span><span class="co">#&gt;   ARMCD AVISIT emmean</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> PBO   VIS1   -<span style="color: #BB0000;">4.60</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> PBO   VIS2   -<span style="color: #BB0000;">2.54</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> PBO   VIS3    0.984</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> PBO   VIS4    5.60 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> TRT   VIS1   -<span style="color: #BB0000;">1.29</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> TRT   VIS2    0.847</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> TRT   VIS3    3.80 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> TRT   VIS4   10.1</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">marginals_custom</span> <span class="op">-</span> <span class="va">marginals_emmeans</span><span class="op">$</span><span class="va">emmean</span></span>
<span><span class="co">#&gt;                   [,1]</span></span>
<span><span class="co">#&gt; PBO|VIS1  0.000000e+00</span></span>
<span><span class="co">#&gt; PBO|VIS2  4.440892e-16</span></span>
<span><span class="co">#&gt; PBO|VIS3 -1.110223e-16</span></span>
<span><span class="co">#&gt; PBO|VIS4 -8.881784e-16</span></span>
<span><span class="co">#&gt; TRT|VIS1 -1.110223e-15</span></span>
<span><span class="co">#&gt; TRT|VIS2 -5.551115e-16</span></span>
<span><span class="co">#&gt; TRT|VIS3 -1.332268e-15</span></span>
<span><span class="co">#&gt; TRT|VIS4 -1.776357e-15</span></span></code></pre></div>
<p>For our Bayesian MMRMs in <code>brms.mmrm</code>, the transformation
from <code><a href="../reference/brm_transform_marginal.html">brm_transform_marginal()</a></code> operates on each individual
draw from the joint posterior distribution. The transformation matrix
produced by <code><a href="../reference/brm_transform_marginal.html">brm_transform_marginal()</a></code> is the value of the
<code>transform</code> argument of <code><a href="../reference/brm_marginal_draws.html">brm_marginal_draws()</a></code>.
That way, <code><a href="../reference/brm_marginal_draws.html">brm_marginal_draws()</a></code> produces an entire estimated
posterior of each marginal mean, rather than point estimates that assume
a normal or Student-t distribution.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;You can then estimate the posterior of any function of
marginal means by simply applying that function to the individual
posterior draws from &lt;code&gt;&lt;a href="../reference/brm_marginal_draws.html"&gt;brm_marginal_draws()&lt;/a&gt;&lt;/code&gt;.
&lt;code&gt;&lt;a href="../reference/brm_marginal_grid.html"&gt;brm_marginal_grid()&lt;/a&gt;&lt;/code&gt; helps identify column names for this
kind of custom inference/post-processing.&lt;/p&gt;'><sup>5</sup></a></p>
</div>
<div class="section level2">
<h2 id="how-brm_marginal_draws-works">How <code>brm_marginal_draws()</code> works<a class="anchor" aria-label="anchor" href="#how-brm_marginal_draws-works"></a>
</h2>
<p>Let us take a closer look at the equations that map model parameters
to marginal means.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">transform</span><span class="op">)</span></span>
<span><span class="co">#&gt; # This is a matrix to transform model parameters to marginal means.</span></span>
<span><span class="co">#&gt; # The following equations show the relationships between the</span></span>
<span><span class="co">#&gt; # marginal means (left-hand side) and fixed effect parameters</span></span>
<span><span class="co">#&gt; # (right-hand side).</span></span>
<span><span class="co">#&gt; # </span></span>
<span><span class="co">#&gt; #   PBO:VIS1 = b_Intercept + 40.13*b_FEV1_BL + 0.38*b_RACEBlackorAfricanAmerican + 0.27*b_RACEWhite + 0.53*b_SEXFemale + 0.52*b_WEIGHT</span></span>
<span><span class="co">#&gt; #   PBO:VIS2 = b_Intercept + 40.13*b_FEV1_BL + b_AVISITVIS2 + 0.38*b_RACEBlackorAfricanAmerican + 0.27*b_RACEWhite + 0.53*b_SEXFemale + 0.52*b_WEIGHT + 40.13*b_FEV1_BL:AVISITVIS2</span></span>
<span><span class="co">#&gt; #   PBO:VIS3 = b_Intercept + 40.13*b_FEV1_BL + b_AVISITVIS3 + 0.38*b_RACEBlackorAfricanAmerican + 0.27*b_RACEWhite + 0.53*b_SEXFemale + 0.52*b_WEIGHT + 40.13*b_FEV1_BL:AVISITVIS3</span></span>
<span><span class="co">#&gt; #   PBO:VIS4 = b_Intercept + 40.13*b_FEV1_BL + b_AVISITVIS4 + 0.38*b_RACEBlackorAfricanAmerican + 0.27*b_RACEWhite + 0.53*b_SEXFemale + 0.52*b_WEIGHT + 40.13*b_FEV1_BL:AVISITVIS4</span></span>
<span><span class="co">#&gt; #   TRT:VIS1 = b_Intercept + 40.13*b_FEV1_BL + b_ARMCDTRT + 0.38*b_RACEBlackorAfricanAmerican + 0.27*b_RACEWhite + 0.53*b_SEXFemale + 0.52*b_WEIGHT</span></span>
<span><span class="co">#&gt; #   TRT:VIS2 = b_Intercept + 40.13*b_FEV1_BL + b_ARMCDTRT + b_AVISITVIS2 + 0.38*b_RACEBlackorAfricanAmerican + 0.27*b_RACEWhite + 0.53*b_SEXFemale + 0.52*b_WEIGHT + 40.13*b_FEV1_BL:AVISITVIS2 + b_ARMCDTRT:AVISITVIS2</span></span>
<span><span class="co">#&gt; #   TRT:VIS3 = b_Intercept + 40.13*b_FEV1_BL + b_ARMCDTRT + b_AVISITVIS3 + 0.38*b_RACEBlackorAfricanAmerican + 0.27*b_RACEWhite + 0.53*b_SEXFemale + 0.52*b_WEIGHT + 40.13*b_FEV1_BL:AVISITVIS3 + b_ARMCDTRT:AVISITVIS3</span></span>
<span><span class="co">#&gt; #   TRT:VIS4 = b_Intercept + 40.13*b_FEV1_BL + b_ARMCDTRT + b_AVISITVIS4 + 0.38*b_RACEBlackorAfricanAmerican + 0.27*b_RACEWhite + 0.53*b_SEXFemale + 0.52*b_WEIGHT + 40.13*b_FEV1_BL:AVISITVIS4 + b_ARMCDTRT:AVISITVIS4</span></span></code></pre></div>
<p>These equations include terms not only for the fixed effects of
interest, but also for nuisance variables <code>FEV1_BL</code>,
<code>SEX</code>, <code>RACE</code>, and <code>WEIGHT</code>. These
nuisance variables were originally part of the model formula, which
means each marginal mean can only be interpreted relative to a fixed
value of <code>FEV1_BL</code>, a fixed proportion of female patients,
etc. For example, if we dropped <code>40.13*b_FEV1_BL</code>, then
<code>PBO:VIS1</code> would be the placebo mean at visit 1 for patients
with <code>FEV1_BL = 0</code>: in other words, patients who cannot
breathe out any air from their lungs at the beginning of the study.
Similarly, if we dropped <code>0.53*b_SEXFemale</code>, then we would
have to interpret <code>PBO:VIS1</code> as the visit 1 placebo mean for
male patients only. Fixed values <code>40.13</code> and
<code>0.53</code> are averages over the data to ensure our marginal
means apply to the entire patient population as a whole.</p>
<p>The major challenge of <code><a href="../reference/brm_transform_marginal.html">brm_transform_marginal()</a></code> is to
condition on nuisance values that represent appropriate averages over
the data. To calculate these nuisance values,
<code><a href="../reference/brm_transform_marginal.html">brm_transform_marginal()</a></code> uses a technique similar to
<code>weights = "proportional"</code> in
<code><a href="https://rvlenth.github.io/emmeans/reference/emmeans.html" class="external-link">emmeans::emmeans()</a></code>.</p>
<p>To replicate <code><a href="../reference/brm_transform_marginal.html">brm_transform_marginal()</a></code>, we first create a
reference grid to define the factor levels of interest and the means of
continuous variables to condition on.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grid</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>FEV1_BL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">FEV1_BL</span><span class="op">)</span>, WEIGHT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">WEIGHT</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">ARMCD</span>, <span class="va">AVISIT</span>, <span class="va">FEV1_BL</span>, <span class="va">WEIGHT</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">ARMCD</span>, <span class="va">AVISIT</span><span class="op">)</span></span>
<span><span class="va">grid</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 4</span></span></span>
<span><span class="co">#&gt;   ARMCD AVISIT FEV1_BL WEIGHT</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> PBO   VIS1      40.1  0.519</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> PBO   VIS2      40.1  0.519</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> PBO   VIS3      40.1  0.519</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> PBO   VIS4      40.1  0.519</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> TRT   VIS1      40.1  0.519</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> TRT   VIS2      40.1  0.519</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> TRT   VIS3      40.1  0.519</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> TRT   VIS4      40.1  0.519</span></span></code></pre></div>
<p>We use the grid to construct a model matrix with the desired
interactions between continuous variables and factors of interest. Each
column represents a model coefficient, and each row represents a
marginal mean of interest.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">transform</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="op">~</span> <span class="va">FEV1_BL</span> <span class="op">*</span> <span class="va">AVISIT</span> <span class="op">+</span> <span class="va">ARMCD</span> <span class="op">*</span> <span class="va">AVISIT</span> <span class="op">+</span> <span class="va">WEIGHT</span>,</span>
<span>  data <span class="op">=</span> <span class="va">grid</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">transform</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">grid</span><span class="op">$</span><span class="va">ARMCD</span>, <span class="va">grid</span><span class="op">$</span><span class="va">AVISIT</span><span class="op">)</span></span>
<span><span class="va">transform</span></span>
<span><span class="co">#&gt;          (Intercept)  FEV1_BL AVISITVIS2 AVISITVIS3 AVISITVIS4 ARMCDTRT</span></span>
<span><span class="co">#&gt; PBO VIS1           1 40.12532          0          0          0        0</span></span>
<span><span class="co">#&gt; PBO VIS2           1 40.12532          1          0          0        0</span></span>
<span><span class="co">#&gt; PBO VIS3           1 40.12532          0          1          0        0</span></span>
<span><span class="co">#&gt; PBO VIS4           1 40.12532          0          0          1        0</span></span>
<span><span class="co">#&gt; TRT VIS1           1 40.12532          0          0          0        1</span></span>
<span><span class="co">#&gt; TRT VIS2           1 40.12532          1          0          0        1</span></span>
<span><span class="co">#&gt; TRT VIS3           1 40.12532          0          1          0        1</span></span>
<span><span class="co">#&gt; TRT VIS4           1 40.12532          0          0          1        1</span></span>
<span><span class="co">#&gt;             WEIGHT FEV1_BL:AVISITVIS2 FEV1_BL:AVISITVIS3 FEV1_BL:AVISITVIS4</span></span>
<span><span class="co">#&gt; PBO VIS1 0.5185461            0.00000            0.00000            0.00000</span></span>
<span><span class="co">#&gt; PBO VIS2 0.5185461           40.12532            0.00000            0.00000</span></span>
<span><span class="co">#&gt; PBO VIS3 0.5185461            0.00000           40.12532            0.00000</span></span>
<span><span class="co">#&gt; PBO VIS4 0.5185461            0.00000            0.00000           40.12532</span></span>
<span><span class="co">#&gt; TRT VIS1 0.5185461            0.00000            0.00000            0.00000</span></span>
<span><span class="co">#&gt; TRT VIS2 0.5185461           40.12532            0.00000            0.00000</span></span>
<span><span class="co">#&gt; TRT VIS3 0.5185461            0.00000           40.12532            0.00000</span></span>
<span><span class="co">#&gt; TRT VIS4 0.5185461            0.00000            0.00000           40.12532</span></span>
<span><span class="co">#&gt;          AVISITVIS2:ARMCDTRT AVISITVIS3:ARMCDTRT AVISITVIS4:ARMCDTRT</span></span>
<span><span class="co">#&gt; PBO VIS1                   0                   0                   0</span></span>
<span><span class="co">#&gt; PBO VIS2                   0                   0                   0</span></span>
<span><span class="co">#&gt; PBO VIS3                   0                   0                   0</span></span>
<span><span class="co">#&gt; PBO VIS4                   0                   0                   0</span></span>
<span><span class="co">#&gt; TRT VIS1                   0                   0                   0</span></span>
<span><span class="co">#&gt; TRT VIS2                   1                   0                   0</span></span>
<span><span class="co">#&gt; TRT VIS3                   0                   1                   0</span></span>
<span><span class="co">#&gt; TRT VIS4                   0                   0                   1</span></span>
<span><span class="co">#&gt; attr(,"assign")</span></span>
<span><span class="co">#&gt;  [1] 0 1 2 2 2 3 4 5 5 5 6 6 6</span></span>
<span><span class="co">#&gt; attr(,"contrasts")</span></span>
<span><span class="co">#&gt; attr(,"contrasts")$AVISIT</span></span>
<span><span class="co">#&gt; [1] "contr.treatment"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"contrasts")$ARMCD</span></span>
<span><span class="co">#&gt; [1] "contr.treatment"</span></span></code></pre></div>
<p>We want to predict at the “average” of <code>SEX</code> and
<code>RACE</code> across all the data. Since <code>SEX</code> and
<code>RACE</code> are factors, we cannot simply take the means of the
variables themselves. Rather, we construct a model matrix to turn each
factor <em>level</em> into a dummy variable, and then average those
dummy variables across the entire dataset. This process accounts for the
observed frequencies of these levels in the data (ideal for passive
variables that the experiment does not directly control), while guarding
against hidden confounding with the factors of interest (which can lead
to Simpson’s paradox).<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;For more context, please refer to the &lt;a href="https://cran.r-project.org/package=emmeans/vignettes/basics.html" class="external-link"&gt;&lt;code&gt;emmeans&lt;/code&gt;
basics vignette&lt;/a&gt;, as well as discussion forums &lt;a href="https://stats.stackexchange.com/questions/332167/what-are-ls-means-useful-for" class="external-link"&gt;here&lt;/a&gt;
and &lt;a href="https://stats.stackexchange.com/questions/510862/is-least-squares-means-lsmeans-statistical-nonsense/510923#510923" class="external-link"&gt;here&lt;/a&gt;.&lt;/p&gt;'><sup>6</sup></a></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">proportional_factors</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span>object <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">SEX</span> <span class="op">+</span> <span class="va">RACE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">proportional_factors</span></span>
<span><span class="co">#&gt;        SEXMale SEXFemale RACEBlack or African American RACEWhite</span></span>
<span><span class="co">#&gt; [1,] 0.4670051 0.5329949                     0.3756345 0.2690355</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">transform</span> <span class="op">&lt;-</span> <span class="va">transform</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="va">proportional_factors</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">transform</span> <span class="op">&lt;-</span> <span class="va">transform</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">transform</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">grid</span><span class="op">$</span><span class="va">ARMCD</span>, <span class="va">grid</span><span class="op">$</span><span class="va">AVISIT</span><span class="op">)</span></span>
<span><span class="va">transform</span></span>
<span><span class="co">#&gt;          (Intercept)  FEV1_BL ARMCDTRT AVISITVIS2 AVISITVIS3 AVISITVIS4</span></span>
<span><span class="co">#&gt; PBO VIS1           1 40.12532        0          0          0          0</span></span>
<span><span class="co">#&gt; PBO VIS2           1 40.12532        0          1          0          0</span></span>
<span><span class="co">#&gt; PBO VIS3           1 40.12532        0          0          1          0</span></span>
<span><span class="co">#&gt; PBO VIS4           1 40.12532        0          0          0          1</span></span>
<span><span class="co">#&gt; TRT VIS1           1 40.12532        1          0          0          0</span></span>
<span><span class="co">#&gt; TRT VIS2           1 40.12532        1          1          0          0</span></span>
<span><span class="co">#&gt; TRT VIS3           1 40.12532        1          0          1          0</span></span>
<span><span class="co">#&gt; TRT VIS4           1 40.12532        1          0          0          1</span></span>
<span><span class="co">#&gt;          RACEBlack or African American RACEWhite SEXFemale    WEIGHT</span></span>
<span><span class="co">#&gt; PBO VIS1                     0.3756345 0.2690355 0.5329949 0.5185461</span></span>
<span><span class="co">#&gt; PBO VIS2                     0.3756345 0.2690355 0.5329949 0.5185461</span></span>
<span><span class="co">#&gt; PBO VIS3                     0.3756345 0.2690355 0.5329949 0.5185461</span></span>
<span><span class="co">#&gt; PBO VIS4                     0.3756345 0.2690355 0.5329949 0.5185461</span></span>
<span><span class="co">#&gt; TRT VIS1                     0.3756345 0.2690355 0.5329949 0.5185461</span></span>
<span><span class="co">#&gt; TRT VIS2                     0.3756345 0.2690355 0.5329949 0.5185461</span></span>
<span><span class="co">#&gt; TRT VIS3                     0.3756345 0.2690355 0.5329949 0.5185461</span></span>
<span><span class="co">#&gt; TRT VIS4                     0.3756345 0.2690355 0.5329949 0.5185461</span></span>
<span><span class="co">#&gt;          FEV1_BL:AVISITVIS2 FEV1_BL:AVISITVIS3 FEV1_BL:AVISITVIS4</span></span>
<span><span class="co">#&gt; PBO VIS1            0.00000            0.00000            0.00000</span></span>
<span><span class="co">#&gt; PBO VIS2           40.12532            0.00000            0.00000</span></span>
<span><span class="co">#&gt; PBO VIS3            0.00000           40.12532            0.00000</span></span>
<span><span class="co">#&gt; PBO VIS4            0.00000            0.00000           40.12532</span></span>
<span><span class="co">#&gt; TRT VIS1            0.00000            0.00000            0.00000</span></span>
<span><span class="co">#&gt; TRT VIS2           40.12532            0.00000            0.00000</span></span>
<span><span class="co">#&gt; TRT VIS3            0.00000           40.12532            0.00000</span></span>
<span><span class="co">#&gt; TRT VIS4            0.00000            0.00000           40.12532</span></span>
<span><span class="co">#&gt;          AVISITVIS2:ARMCDTRT AVISITVIS3:ARMCDTRT AVISITVIS4:ARMCDTRT</span></span>
<span><span class="co">#&gt; PBO VIS1                   0                   0                   0</span></span>
<span><span class="co">#&gt; PBO VIS2                   0                   0                   0</span></span>
<span><span class="co">#&gt; PBO VIS3                   0                   0                   0</span></span>
<span><span class="co">#&gt; PBO VIS4                   0                   0                   0</span></span>
<span><span class="co">#&gt; TRT VIS1                   0                   0                   0</span></span>
<span><span class="co">#&gt; TRT VIS2                   1                   0                   0</span></span>
<span><span class="co">#&gt; TRT VIS3                   0                   1                   0</span></span>
<span><span class="co">#&gt; TRT VIS4                   0                   0                   1</span></span></code></pre></div>
<p>Finally, we use this transformation matrix to map estimated model
coefficients to estimated marginal means.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">marginals_custom</span> <span class="op">&lt;-</span> <span class="va">transform</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="va">marginals_custom</span></span>
<span><span class="co">#&gt;                [,1]</span></span>
<span><span class="co">#&gt; PBO VIS1 -4.5998295</span></span>
<span><span class="co">#&gt; PBO VIS2 -2.5445943</span></span>
<span><span class="co">#&gt; PBO VIS3  0.9841880</span></span>
<span><span class="co">#&gt; PBO VIS4  5.6013241</span></span>
<span><span class="co">#&gt; TRT VIS1 -1.2858526</span></span>
<span><span class="co">#&gt; TRT VIS2  0.8466639</span></span>
<span><span class="co">#&gt; TRT VIS3  3.8011416</span></span>
<span><span class="co">#&gt; TRT VIS4 10.0521521</span></span></code></pre></div>
<p>These results are extremely close to the estimated marginal means
from <code>emmeans</code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">marginals_emmeans</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span>custom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">marginals_custom</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>difference <span class="op">=</span> <span class="va">custom</span> <span class="op">-</span> <span class="va">emmean</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 5</span></span></span>
<span><span class="co">#&gt;   ARMCD AVISIT emmean custom difference</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> PBO   VIS1   -<span style="color: #BB0000;">4.60</span>  -<span style="color: #BB0000;">4.60</span>    0   <span style="color: #949494;"> </span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> PBO   VIS2   -<span style="color: #BB0000;">2.54</span>  -<span style="color: #BB0000;">2.54</span>    4.44<span style="color: #949494;">e</span><span style="color: #BB0000;">-16</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> PBO   VIS3    0.984  0.984  -<span style="color: #BB0000;">1.11</span><span style="color: #949494;">e</span><span style="color: #BB0000;">-16</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> PBO   VIS4    5.60   5.60   -<span style="color: #BB0000;">8.88</span><span style="color: #949494;">e</span><span style="color: #BB0000;">-16</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> TRT   VIS1   -<span style="color: #BB0000;">1.29</span>  -<span style="color: #BB0000;">1.29</span>   -<span style="color: #BB0000;">1.11</span><span style="color: #949494;">e</span><span style="color: #BB0000;">-15</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> TRT   VIS2    0.847  0.847  -<span style="color: #BB0000;">5.55</span><span style="color: #949494;">e</span><span style="color: #BB0000;">-16</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> TRT   VIS3    3.80   3.80   -<span style="color: #BB0000;">1.33</span><span style="color: #949494;">e</span><span style="color: #BB0000;">-15</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> TRT   VIS4   10.1   10.1    -<span style="color: #BB0000;">1.78</span><span style="color: #949494;">e</span><span style="color: #BB0000;">-15</span></span></span></code></pre></div>
<p><code>brms.mmrm</code> follows the procedure above, but in a Bayesian
context. The <code><a href="../reference/brm_transform_marginal.html">brm_transform_marginal()</a></code> creates the matrix
above, and <code><a href="../reference/brm_marginal_draws.html">brm_marginal_draws()</a></code> uses it to transform
posterior draws of <code>brms</code> model coefficients into posterior
draws of marginal means. These posterior draws of marginal means then
support estimation of treatment effects (via
<code><a href="../reference/brm_marginal_draws.html">brm_marginal_draws()</a></code> and
<code><a href="../reference/brm_marginal_summaries.html">brm_marginal_summaries()</a></code>) and posterior probabilities on
those treatment effects (via <code><a href="../reference/brm_marginal_probabilities.html">brm_marginal_probabilities()</a></code>).
To fine-tune the marginal mean estimation procedure for niche use cases,
you can modify the transformation returned from
<code><a href="../reference/brm_transform_marginal.html">brm_transform_marginal()</a></code> and then supply it to the
<code>transform</code> argument of
<code><a href="../reference/brm_marginal_draws.html">brm_marginal_draws()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="subgroup-analysis">Subgroup analysis<a class="anchor" aria-label="anchor" href="#subgroup-analysis"></a>
</h2>
<p>Subgroup analysis raises important questions about how nuisance
variables are averaged, and you as the user are responsible for choosing
the approach that best suits the situation. To illustrate, suppose
<code>SEX</code> is a pre-specified subgroup. When estimating marginal
means, we now wish to condition on <code>"Female"</code> vs
<code>"Male"</code> while averaging over <code>RACE</code> across the
whole dataset. In <code>emmeans</code>, this is similar to how we
calculated <code>marginals_emmeans</code> above, but we now move
<code>SEX</code> from <code>nuisance</code> to <code>specs</code>:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rvlenth.github.io/emmeans/reference/emmeans.html" class="external-link">emmeans</a></span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="va">model</span>,</span>
<span>  specs <span class="op">=</span> <span class="op">~</span><span class="va">SEX</span><span class="op">:</span><span class="va">ARMCD</span><span class="op">:</span><span class="va">AVISIT</span>,</span>
<span>  weights <span class="op">=</span> <span class="st">"proportional"</span>,</span>
<span>  nuisance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"USUBJID"</span>, <span class="st">"RACE"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;  SEX    ARMCD AVISIT emmean    SE  df lower.CL upper.CL</span></span>
<span><span class="co">#&gt;  Male   PBO   VIS1   -5.014 0.752 772   -6.490   -3.538</span></span>
<span><span class="co">#&gt;  Female PBO   VIS1   -4.237 0.743 772   -5.696   -2.778</span></span>
<span><span class="co">#&gt;  Male   TRT   VIS1   -1.700 0.800 772   -3.270   -0.130</span></span>
<span><span class="co">#&gt;  Female TRT   VIS1   -0.923 0.786 772   -2.466    0.620</span></span>
<span><span class="co">#&gt;  Male   PBO   VIS2   -2.959 0.752 772   -4.435   -1.482</span></span>
<span><span class="co">#&gt;  Female PBO   VIS2   -2.182 0.743 772   -3.640   -0.723</span></span>
<span><span class="co">#&gt;  Male   TRT   VIS2    0.433 0.800 772   -1.137    2.003</span></span>
<span><span class="co">#&gt;  Female TRT   VIS2    1.209 0.786 772   -0.333    2.752</span></span>
<span><span class="co">#&gt;  Male   PBO   VIS3    0.570 0.752 772   -0.906    2.046</span></span>
<span><span class="co">#&gt;  Female PBO   VIS3    1.347 0.743 772   -0.112    2.806</span></span>
<span><span class="co">#&gt;  Male   TRT   VIS3    3.387 0.800 772    1.816    4.958</span></span>
<span><span class="co">#&gt;  Female TRT   VIS3    4.164 0.786 772    2.621    5.707</span></span>
<span><span class="co">#&gt;  Male   PBO   VIS4    5.187 0.752 772    3.712    6.663</span></span>
<span><span class="co">#&gt;  Female PBO   VIS4    5.964 0.743 772    4.506    7.422</span></span>
<span><span class="co">#&gt;  Male   TRT   VIS4    9.638 0.800 772    8.067   11.209</span></span>
<span><span class="co">#&gt;  Female TRT   VIS4   10.415 0.786 772    8.872   11.958</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Results are averaged over the levels of: 1 nuisance factors </span></span>
<span><span class="co">#&gt; Confidence level used: 0.95</span></span></code></pre></div>
<p>This may be reasonable in some cases, and it mitigates the kind of
hidden confounding between the subgroup and other variables which may
otherwise cause Simpson’s paradox. However, for subgroup-specific
marginal means, it may not be realistic to condition on a single point
estimate for all levels of the reference grid. For example, if the model
were to regress on a <code>pregnancy</code> variable, then the marginal
means for <code>SEX = "Male"</code> should always condition on
<code>pregnancy = 0</code> instead of <code>mean(data$pregnancy)</code>.
And in general, it may be more reasonable to condition on
subgroup-specific averages of nuisance variables. However, if you do
this, it is your responsibility to investigate and understand the hidden
interactions and confounding in your dataset. <a href="https://cran.r-project.org/package=emmeans/vignettes/interactions.html" class="external-link uri">https://cran.r-project.org/package=emmeans/vignettes/interactions.html</a>
is an edifying vignette on this topic.</p>
<p>To opt into subgroup-specific averages of nuisance variables in
<code>brms.mmrm</code>, set <code>average_within_subgroup = TRUE</code>
in <code><a href="../reference/brm_transform_marginal.html">brm_transform_marginal()</a></code>, then supply the output to the
<code>transform</code> argument of
<code><a href="../reference/brm_marginal_draws.html">brm_marginal_draws()</a></code>.</p>
<p>To replicate
<code>brm_transform_marginal(average_within_subgroup = TRUE)</code> from
scratch, first create a reference grid which includes subgroup
levels.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grid</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">ARMCD</span>, <span class="va">SEX</span>, <span class="va">AVISIT</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">ARMCD</span>, <span class="va">SEX</span>, <span class="va">AVISIT</span><span class="op">)</span></span>
<span><span class="va">grid</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 16 × 3</span></span></span>
<span><span class="co">#&gt;    ARMCD SEX    AVISIT</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> PBO   Male   VIS1  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> PBO   Male   VIS2  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> PBO   Male   VIS3  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> PBO   Male   VIS4  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> PBO   Female VIS1  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> PBO   Female VIS2  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> PBO   Female VIS3  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> PBO   Female VIS4  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> TRT   Male   VIS1  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> TRT   Male   VIS2  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> TRT   Male   VIS3  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> TRT   Male   VIS4  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> TRT   Female VIS1  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> TRT   Female VIS2  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> TRT   Female VIS3  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> TRT   Female VIS4</span></span></code></pre></div>
<p>For each continuous variable, append the corresponding
subgroup-specific averages to the grid.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">means</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">SEX</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>FEV1_BL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">FEV1_BL</span><span class="op">)</span>, WEIGHT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">WEIGHT</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span></span>
<span><span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">grid</span>, y <span class="op">=</span> <span class="va">means</span>, by <span class="op">=</span> <span class="st">"SEX"</span><span class="op">)</span></span>
<span><span class="va">grid</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 16 × 5</span></span></span>
<span><span class="co">#&gt;    ARMCD SEX    AVISIT FEV1_BL WEIGHT</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> PBO   Male   VIS1      40.3  0.516</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> PBO   Male   VIS2      40.3  0.516</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> PBO   Male   VIS3      40.3  0.516</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> PBO   Male   VIS4      40.3  0.516</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> PBO   Female VIS1      39.9  0.521</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> PBO   Female VIS2      39.9  0.521</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> PBO   Female VIS3      39.9  0.521</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> PBO   Female VIS4      39.9  0.521</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> TRT   Male   VIS1      40.3  0.516</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> TRT   Male   VIS2      40.3  0.516</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> TRT   Male   VIS3      40.3  0.516</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> TRT   Male   VIS4      40.3  0.516</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> TRT   Female VIS1      39.9  0.521</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> TRT   Female VIS2      39.9  0.521</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> TRT   Female VIS3      39.9  0.521</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> TRT   Female VIS4      39.9  0.521</span></span></code></pre></div>
<p>Begin creating the variable transformation matrix using this new
grid. Be sure to include the subgroup in the formula below exactly as it
appears in the formula used to fit the model.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">transform</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="op">~</span> <span class="va">FEV1_BL</span> <span class="op">*</span> <span class="va">AVISIT</span> <span class="op">+</span> <span class="va">ARMCD</span> <span class="op">*</span> <span class="va">AVISIT</span> <span class="op">+</span> <span class="va">SEX</span> <span class="op">+</span> <span class="va">WEIGHT</span>,</span>
<span>  data <span class="op">=</span> <span class="va">grid</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Append subgroup-specific averages of the levels of nuisance factors
(in this case, just <code>RACE</code>).</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">proportions</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span>object <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">RACE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>SEX <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">SEX</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">SEX</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">mean</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span></span>
<span><span class="va">transform</span> <span class="op">&lt;-</span> <span class="va">transform</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>SEX <span class="op">=</span> <span class="va">grid</span><span class="op">$</span><span class="va">SEX</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">proportions</span>, by <span class="op">=</span> <span class="st">"SEX"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">SEX</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Complete the transformation matrix by assigning the correct row names
and aligning the column order with that of the model coefficients.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">transform</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">grid</span><span class="op">$</span><span class="va">ARMCD</span>, <span class="va">grid</span><span class="op">$</span><span class="va">SEX</span>, <span class="va">grid</span><span class="op">$</span><span class="va">AVISIT</span><span class="op">)</span></span>
<span><span class="va">transform</span> <span class="op">&lt;-</span> <span class="va">transform</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">transform</span></span>
<span><span class="co">#&gt;                 (Intercept)  FEV1_BL ARMCDTRT AVISITVIS2 AVISITVIS3 AVISITVIS4</span></span>
<span><span class="co">#&gt; PBO Male VIS1             1 40.34215        0          0          0          0</span></span>
<span><span class="co">#&gt; PBO Male VIS2             1 40.34215        0          1          0          0</span></span>
<span><span class="co">#&gt; PBO Male VIS3             1 40.34215        0          0          1          0</span></span>
<span><span class="co">#&gt; PBO Male VIS4             1 40.34215        0          0          0          1</span></span>
<span><span class="co">#&gt; PBO Female VIS1           1 39.93534        0          0          0          0</span></span>
<span><span class="co">#&gt; PBO Female VIS2           1 39.93534        0          1          0          0</span></span>
<span><span class="co">#&gt; PBO Female VIS3           1 39.93534        0          0          1          0</span></span>
<span><span class="co">#&gt; PBO Female VIS4           1 39.93534        0          0          0          1</span></span>
<span><span class="co">#&gt; TRT Male VIS1             1 40.34215        1          0          0          0</span></span>
<span><span class="co">#&gt; TRT Male VIS2             1 40.34215        1          1          0          0</span></span>
<span><span class="co">#&gt; TRT Male VIS3             1 40.34215        1          0          1          0</span></span>
<span><span class="co">#&gt; TRT Male VIS4             1 40.34215        1          0          0          1</span></span>
<span><span class="co">#&gt; TRT Female VIS1           1 39.93534        1          0          0          0</span></span>
<span><span class="co">#&gt; TRT Female VIS2           1 39.93534        1          1          0          0</span></span>
<span><span class="co">#&gt; TRT Female VIS3           1 39.93534        1          0          1          0</span></span>
<span><span class="co">#&gt; TRT Female VIS4           1 39.93534        1          0          0          1</span></span>
<span><span class="co">#&gt;                 RACEBlack or African American RACEWhite SEXFemale    WEIGHT</span></span>
<span><span class="co">#&gt; PBO Male VIS1                       0.4239130 0.2826087         0 0.5161276</span></span>
<span><span class="co">#&gt; PBO Male VIS2                       0.4239130 0.2826087         0 0.5161276</span></span>
<span><span class="co">#&gt; PBO Male VIS3                       0.4239130 0.2826087         0 0.5161276</span></span>
<span><span class="co">#&gt; PBO Male VIS4                       0.4239130 0.2826087         0 0.5161276</span></span>
<span><span class="co">#&gt; PBO Female VIS1                     0.3333333 0.2571429         1 0.5206653</span></span>
<span><span class="co">#&gt; PBO Female VIS2                     0.3333333 0.2571429         1 0.5206653</span></span>
<span><span class="co">#&gt; PBO Female VIS3                     0.3333333 0.2571429         1 0.5206653</span></span>
<span><span class="co">#&gt; PBO Female VIS4                     0.3333333 0.2571429         1 0.5206653</span></span>
<span><span class="co">#&gt; TRT Male VIS1                       0.4239130 0.2826087         0 0.5161276</span></span>
<span><span class="co">#&gt; TRT Male VIS2                       0.4239130 0.2826087         0 0.5161276</span></span>
<span><span class="co">#&gt; TRT Male VIS3                       0.4239130 0.2826087         0 0.5161276</span></span>
<span><span class="co">#&gt; TRT Male VIS4                       0.4239130 0.2826087         0 0.5161276</span></span>
<span><span class="co">#&gt; TRT Female VIS1                     0.3333333 0.2571429         1 0.5206653</span></span>
<span><span class="co">#&gt; TRT Female VIS2                     0.3333333 0.2571429         1 0.5206653</span></span>
<span><span class="co">#&gt; TRT Female VIS3                     0.3333333 0.2571429         1 0.5206653</span></span>
<span><span class="co">#&gt; TRT Female VIS4                     0.3333333 0.2571429         1 0.5206653</span></span>
<span><span class="co">#&gt;                 FEV1_BL:AVISITVIS2 FEV1_BL:AVISITVIS3 FEV1_BL:AVISITVIS4</span></span>
<span><span class="co">#&gt; PBO Male VIS1              0.00000            0.00000            0.00000</span></span>
<span><span class="co">#&gt; PBO Male VIS2             40.34215            0.00000            0.00000</span></span>
<span><span class="co">#&gt; PBO Male VIS3              0.00000           40.34215            0.00000</span></span>
<span><span class="co">#&gt; PBO Male VIS4              0.00000            0.00000           40.34215</span></span>
<span><span class="co">#&gt; PBO Female VIS1            0.00000            0.00000            0.00000</span></span>
<span><span class="co">#&gt; PBO Female VIS2           39.93534            0.00000            0.00000</span></span>
<span><span class="co">#&gt; PBO Female VIS3            0.00000           39.93534            0.00000</span></span>
<span><span class="co">#&gt; PBO Female VIS4            0.00000            0.00000           39.93534</span></span>
<span><span class="co">#&gt; TRT Male VIS1              0.00000            0.00000            0.00000</span></span>
<span><span class="co">#&gt; TRT Male VIS2             40.34215            0.00000            0.00000</span></span>
<span><span class="co">#&gt; TRT Male VIS3              0.00000           40.34215            0.00000</span></span>
<span><span class="co">#&gt; TRT Male VIS4              0.00000            0.00000           40.34215</span></span>
<span><span class="co">#&gt; TRT Female VIS1            0.00000            0.00000            0.00000</span></span>
<span><span class="co">#&gt; TRT Female VIS2           39.93534            0.00000            0.00000</span></span>
<span><span class="co">#&gt; TRT Female VIS3            0.00000           39.93534            0.00000</span></span>
<span><span class="co">#&gt; TRT Female VIS4            0.00000            0.00000           39.93534</span></span>
<span><span class="co">#&gt;                 AVISITVIS2:ARMCDTRT AVISITVIS3:ARMCDTRT AVISITVIS4:ARMCDTRT</span></span>
<span><span class="co">#&gt; PBO Male VIS1                     0                   0                   0</span></span>
<span><span class="co">#&gt; PBO Male VIS2                     0                   0                   0</span></span>
<span><span class="co">#&gt; PBO Male VIS3                     0                   0                   0</span></span>
<span><span class="co">#&gt; PBO Male VIS4                     0                   0                   0</span></span>
<span><span class="co">#&gt; PBO Female VIS1                   0                   0                   0</span></span>
<span><span class="co">#&gt; PBO Female VIS2                   0                   0                   0</span></span>
<span><span class="co">#&gt; PBO Female VIS3                   0                   0                   0</span></span>
<span><span class="co">#&gt; PBO Female VIS4                   0                   0                   0</span></span>
<span><span class="co">#&gt; TRT Male VIS1                     0                   0                   0</span></span>
<span><span class="co">#&gt; TRT Male VIS2                     1                   0                   0</span></span>
<span><span class="co">#&gt; TRT Male VIS3                     0                   1                   0</span></span>
<span><span class="co">#&gt; TRT Male VIS4                     0                   0                   1</span></span>
<span><span class="co">#&gt; TRT Female VIS1                   0                   0                   0</span></span>
<span><span class="co">#&gt; TRT Female VIS2                   1                   0                   0</span></span>
<span><span class="co">#&gt; TRT Female VIS3                   0                   1                   0</span></span>
<span><span class="co">#&gt; TRT Female VIS4                   0                   0                   1</span></span></code></pre></div>
<p>Finally, use the custom <code>transform</code> matrix to estimate
subgroup-specific marginal means. Because we averaged
<code>FEV1_BL</code>, <code>WEIGHT</code>, and <code>RACE</code> within
subgroup levels, the results will differ from those of
<code>emmeans</code>.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">transform</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="co">#&gt;                       [,1]</span></span>
<span><span class="co">#&gt; PBO Male VIS1   -5.0812041</span></span>
<span><span class="co">#&gt; PBO Male VIS2   -3.0267423</span></span>
<span><span class="co">#&gt; PBO Male VIS3    0.5040980</span></span>
<span><span class="co">#&gt; PBO Male VIS4    5.1144252</span></span>
<span><span class="co">#&gt; PBO Female VIS1 -4.1780538</span></span>
<span><span class="co">#&gt; PBO Female VIS2 -2.1221408</span></span>
<span><span class="co">#&gt; PBO Female VIS3  1.4048382</span></span>
<span><span class="co">#&gt; PBO Female VIS4  6.0279403</span></span>
<span><span class="co">#&gt; TRT Male VIS1   -1.7672272</span></span>
<span><span class="co">#&gt; TRT Male VIS2    0.3645159</span></span>
<span><span class="co">#&gt; TRT Male VIS3    3.3210517</span></span>
<span><span class="co">#&gt; TRT Male VIS4    9.5652532</span></span>
<span><span class="co">#&gt; TRT Female VIS1 -0.8640769</span></span>
<span><span class="co">#&gt; TRT Female VIS2  1.2691174</span></span>
<span><span class="co">#&gt; TRT Female VIS3  4.2217919</span></span>
<span><span class="co">#&gt; TRT Female VIS4 10.4787682</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-bedrick1996" class="csl-entry">
Bedrick, E. J., Christensen, R., and Johnson, W. (1996), <span>“A new
perspective on priors for generalized linear models,”</span> <em>Journal
of the American Statistical Association</em>, 91, 1450–1460. <a href="https://doi.org/10.2307/2291571" class="external-link">https://doi.org/10.2307/2291571</a>.
</div>
<div id="ref-bedrick1997" class="csl-entry">
Bedrick, E. J., Christensen, R., and Johnson, W. (1997), <span>“Bayesian
binomial regression: Predicting survival at a trauma center,”</span>
<em>Journal of the American Statistical Association</em>, 51, 211–218.
<a href="https://doi.org/10.2307/2684890" class="external-link">https://doi.org/10.2307/2684890</a>.
</div>
<div id="ref-christensen2010" class="csl-entry">
Christensen, R., Johnson, W., Branscum, A., and Hanson, T. E. (2010),
<em>Bayesian ideas and data analysis</em>, CRC Press, Taylor; Francis
Group, p. 203. <a href="https://doi.org/10.1201/9781439894798" class="external-link">https://doi.org/10.1201/9781439894798</a>.
</div>
<div id="ref-lenth2016" class="csl-entry">
Lenth, R. V. (2016), <span>“Least-squares means: The r package
lsmeans,”</span> <em>Journal of Statistical Software</em>, 69, 1–33. <a href="https://doi.org/10.18637/jss.v069.i01" class="external-link">https://doi.org/10.18637/jss.v069.i01</a>.
</div>
<div id="ref-rosner2021" class="csl-entry">
Rosner, G. L., Laud, P. W., and Johnson, W. O. (2021), <em>Bayesian
thinking in biostatistics</em>, CRC Press, Taylor; Francis Group. <a href="https://doi.org/10.1201/9781439800102" class="external-link">https://doi.org/10.1201/9781439800102</a>.
</div>
<div id="ref-searle1979" class="csl-entry">
Searle, S. R., Speed, F. M., and Milliken, G. A. (1980),
<span>“Population marginal means in the linear model: An alternative to
least squares means,”</span> <em>The American Statistician</em>, 34,
216–221. <a href="https://doi.org/10.1080/00031305.1980.10483031" class="external-link">https://doi.org/10.1080/00031305.1980.10483031</a>.
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by William Michael Landau, Kevin Kunzmann, Yoni Sidi, Christian Stock, Eli Lilly and Company, Boehringer Ingelheim Pharma GmbH &amp; Co. KG.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
