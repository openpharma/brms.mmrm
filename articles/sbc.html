<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="brms.mmrm">
<title>Simulation-based calibration checking • brms.mmrm</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulation-based calibration checking">
<meta property="og:description" content="brms.mmrm">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">brms.mmrm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9005</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Usage</h6>
    <a class="dropdown-item" href="../articles/usage.html">Usage</a>
    <a class="dropdown-item" href="../articles/subgroup.html">Subgroup analysis</a>
    <a class="dropdown-item" href="../articles/simulation.html">Simulation</a>
    <a class="dropdown-item" href="../articles/archetypes.html">Informative prior archetypes</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Validation</h6>
    <a class="dropdown-item" href="../articles/sbc.html">Simulation-based calibration checking</a>
    <a class="dropdown-item" href="../articles/fev1.html">FEV1 data comparison between Bayesian and frequentist MMRMs</a>
    <a class="dropdown-item" href="../articles/bcva.html">BCVA data comparison between Bayesian and frequentist MMRMs</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/index.html">More articles...</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/openpharma/brms.mmrm/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Simulation-based calibration checking</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/openpharma/brms.mmrm/blob/HEAD/vignettes/sbc.Rmd" class="external-link"><code>vignettes/sbc.Rmd</code></a></small>
      <div class="d-none name"><code>sbc.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="about">About<a class="anchor" aria-label="anchor" href="#about"></a>
</h2>
<p>This vignette shows the results of a simulation-based calibration
(SBC) checking study to validate the implementation of the models in
<code>brms.mmrm</code>. SBC checking tests the ability of a Bayesian
model to recapture the parameters used to simulate prior predictive
data. For details on SBC checking, please read <span class="citation">Modrák et al. (2024)</span> and the <a href="https://hyunjimoon.github.io/SBC/" class="external-link"><code>SBC</code></a> R package
<span class="citation">(Kim et al. 2022)</span>. This particular SBC
checking study uses the <a href="https://docs.ropensci.org/targets/" class="external-link"><code>targets</code></a>
pipeline in the <a href="https://github.com/openpharma/brms.mmrm/tree/main/vignettes/sbc" class="external-link"><code>viggnettes/sbc/</code></a>
subdirectory of the <a href="https://github.com/openpharma/brms.mmrm" class="external-link"><code>brms.mmrm</code></a>
package source code.</p>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>From the results below, the SBC rank statistics are approximately
uniformly distributed. In other words, the posterior distribution from
the <code>brms</code>/Stan MMRM modeling code matches the prior from
which the datasets were simulated. This is evidence that both the
subgroup and non-subgroup models in <code>brms.mmrm</code> are
implemented correctly.</p>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>To show the SBC checking results in this vignette, we first load code
from the SBC checking study, and we use custom functions to read and
plot rank statistics:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"sbc/R/prior.R"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"sbc/R/response.R"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"sbc/R/scenarios.R"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">read_ranks</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">path</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">fst</span><span class="fu">::</span><span class="fu"><a href="http://www.fstpackage.org/reference/write_fst.html" class="external-link">read_fst</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span></span>
<span>      cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      names_to <span class="op">=</span> <span class="st">"parameter"</span>,</span>
<span>      values_to <span class="op">=</span> <span class="st">"rank"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">plot_ranks</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">ranks</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ranks</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rank</span><span class="op">)</span>,</span>
<span>      breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0</span>, to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">ranks</span><span class="op">$</span><span class="va">rank</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">parameter</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Each section below is its own SBC checking study based on a given
modeling scenario. Each scenario shows results from 1000 independent
simulations from the prior.</p>
</div>
<div class="section level2">
<h2 id="subgroup-scenario">Subgroup scenario<a class="anchor" aria-label="anchor" href="#subgroup-scenario"></a>
</h2>
<p>The subgroup scenario distinguishes itself from the others by the
presence of a subgroup factor. Assumptions:</p>
<ul>
<li>2 treatment groups</li>
<li>2 subgroup levels</li>
<li>3 time points</li>
<li>150 patients per treatment group</li>
<li>Baseline covariates (2 continuous and 2 categorical)</li>
<li>30% dropout</li>
<li>8% rate of independent/sporadic missing response.</li>
</ul>
<p>Model formula:</p>
<pre><code><span><span class="co">#&gt; response ~ group + group:subgroup + group:subgroup:time + group:time + subgroup + subgroup:time + time + continuous1 + continuous2 + balanced + unbalanced + unstr(time = time, gr = patient) </span></span>
<span><span class="co">#&gt; sigma ~ 0 + time</span></span></code></pre>
<p>The prior was randomly generated and used for both simulation and
analysis:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">setup_prior</span><span class="op">(</span><span class="va">subgroup</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">prior</span>, <span class="va">class</span>, <span class="va">coef</span>, <span class="va">dpar</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;                      prior     class                                       coef</span></span>
<span><span class="co">#&gt; 2  normal(-0.1736, 0.6054)         b                             balancedlevel2</span></span>
<span><span class="co">#&gt; 3   normal(-0.0447, 0.855)         b                             balancedlevel3</span></span>
<span><span class="co">#&gt; 4   normal(0.0406, 0.5496)         b                                continuous1</span></span>
<span><span class="co">#&gt; 5  normal(-0.0324, 0.7433)         b                                continuous2</span></span>
<span><span class="co">#&gt; 6  normal(-0.0181, 2.3641)         b                               groupgroup_2</span></span>
<span><span class="co">#&gt; 7    normal(0.2398, 1.451)         b            groupgroup_2:subgroupsubgroup_2</span></span>
<span><span class="co">#&gt; 8  normal(-0.0082, 2.7447)         b groupgroup_2:subgroupsubgroup_2:timetime_2</span></span>
<span><span class="co">#&gt; 9  normal(-0.1206, 0.9984)         b groupgroup_2:subgroupsubgroup_2:timetime_3</span></span>
<span><span class="co">#&gt; 10  normal(0.0883, 2.7254)         b                    groupgroup_2:timetime_2</span></span>
<span><span class="co">#&gt; 11  normal(0.0347, 0.3068)         b                    groupgroup_2:timetime_3</span></span>
<span><span class="co">#&gt; 12  normal(0.1064, 2.8303)         b                         subgroupsubgroup_2</span></span>
<span><span class="co">#&gt; 13  normal(0.1894, 1.2434)         b              subgroupsubgroup_2:timetime_2</span></span>
<span><span class="co">#&gt; 14 normal(-0.0294, 1.0162)         b              subgroupsubgroup_2:timetime_3</span></span>
<span><span class="co">#&gt; 15  normal(0.0649, 2.0052)         b                                 timetime_2</span></span>
<span><span class="co">#&gt; 16  normal(0.0826, 1.9545)         b                                 timetime_3</span></span>
<span><span class="co">#&gt; 17  normal(0.0491, 1.3319)         b                           unbalancedlevel2</span></span>
<span><span class="co">#&gt; 18   normal(-0.156, 1.255)         b                           unbalancedlevel3</span></span>
<span><span class="co">#&gt; 19             lkj(1.3461)   cortime                                           </span></span>
<span><span class="co">#&gt; 20   normal(0.088, 2.6479) Intercept                                           </span></span>
<span><span class="co">#&gt; 22  normal(0.0879, 2.8273)         b                                 timetime_1</span></span>
<span><span class="co">#&gt; 23  normal(0.2299, 2.2228)         b                                 timetime_2</span></span>
<span><span class="co">#&gt; 24  normal(0.0095, 2.2667)         b                                 timetime_3</span></span>
<span><span class="co">#&gt;     dpar</span></span>
<span><span class="co">#&gt; 2       </span></span>
<span><span class="co">#&gt; 3       </span></span>
<span><span class="co">#&gt; 4       </span></span>
<span><span class="co">#&gt; 5       </span></span>
<span><span class="co">#&gt; 6       </span></span>
<span><span class="co">#&gt; 7       </span></span>
<span><span class="co">#&gt; 8       </span></span>
<span><span class="co">#&gt; 9       </span></span>
<span><span class="co">#&gt; 10      </span></span>
<span><span class="co">#&gt; 11      </span></span>
<span><span class="co">#&gt; 12      </span></span>
<span><span class="co">#&gt; 13      </span></span>
<span><span class="co">#&gt; 14      </span></span>
<span><span class="co">#&gt; 15      </span></span>
<span><span class="co">#&gt; 16      </span></span>
<span><span class="co">#&gt; 17      </span></span>
<span><span class="co">#&gt; 18      </span></span>
<span><span class="co">#&gt; 19      </span></span>
<span><span class="co">#&gt; 20      </span></span>
<span><span class="co">#&gt; 22 sigma</span></span>
<span><span class="co">#&gt; 23 sigma</span></span>
<span><span class="co">#&gt; 24 sigma</span></span></code></pre></div>
<p>The following histograms show the SBC rank statistics which compare
the prior parameter draws draws to the posterior draws. If the data
simulation code and modeling code are both correct and consistent, then
the rank statistics should be uniformly distributed.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ranks_subgroup</span> <span class="op">&lt;-</span> <span class="fu">read_ranks</span><span class="op">(</span><span class="st">"sbc/results/subgroup.fst"</span><span class="op">)</span></span></code></pre></div>
<p>Fixed effect parameter ranks:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ranks_subgroup</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^b_"</span>, <span class="va">parameter</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^b_sigma"</span>, <span class="va">parameter</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">plot_ranks</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="sbc_files/figure-html/unnamed-chunk-6-1.png" width="768"></p>
<p>Standard deviation parameter ranks:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ranks_subgroup</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"b_sigma"</span>, <span class="va">parameter</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">plot_ranks</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="sbc_files/figure-html/unnamed-chunk-7-1.png" width="768"></p>
<p>Correlation parameter ranks:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ranks_subgroup</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"cortime_"</span>, <span class="va">parameter</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">plot_ranks</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="sbc_files/figure-html/unnamed-chunk-8-1.png" width="768"></p>
</div>
<div class="section level2">
<h2 id="unstructured-scenario">Unstructured scenario<a class="anchor" aria-label="anchor" href="#unstructured-scenario"></a>
</h2>
<p>This scenario uses unstructured correlation and does not use a
subgroup variable. Assumptions:</p>
<ul>
<li>3 treatment groups</li>
<li>No subgroup</li>
<li>4 time points</li>
<li>100 patients per treatment group</li>
<li>No covariate adjustment</li>
<li>No missing responses</li>
</ul>
<p>Model formula:</p>
<pre><code><span><span class="co">#&gt; response ~ 0 + group + time + unstr(time = time, gr = patient) </span></span>
<span><span class="co">#&gt; sigma ~ 0 + time</span></span></code></pre>
<p>The prior was randomly generated and used for both simulation and
analysis:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">setup_prior</span><span class="op">(</span><span class="va">unstructured</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">prior</span>, <span class="va">class</span>, <span class="va">coef</span>, <span class="va">dpar</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;                      prior   class         coef  dpar</span></span>
<span><span class="co">#&gt; 2  normal(-0.1005, 1.6313)       b groupgroup_1      </span></span>
<span><span class="co">#&gt; 3   normal(0.2389, 0.4785)       b groupgroup_2      </span></span>
<span><span class="co">#&gt; 4  normal(-0.1541, 1.2388)       b groupgroup_3      </span></span>
<span><span class="co">#&gt; 5  normal(-0.0835, 2.2302)       b   timetime_2      </span></span>
<span><span class="co">#&gt; 6  normal(-0.0266, 1.9245)       b   timetime_3      </span></span>
<span><span class="co">#&gt; 7  normal(-0.1762, 2.2366)       b   timetime_4      </span></span>
<span><span class="co">#&gt; 8              lkj(1.1812) cortime                   </span></span>
<span><span class="co">#&gt; 10 normal(-0.0388, 2.5623)       b   timetime_1 sigma</span></span>
<span><span class="co">#&gt; 11  normal(0.1653, 2.7346)       b   timetime_2 sigma</span></span>
<span><span class="co">#&gt; 12  normal(0.0359, 2.3959)       b   timetime_3 sigma</span></span>
<span><span class="co">#&gt; 13   normal(0.127, 2.5864)       b   timetime_4 sigma</span></span></code></pre></div>
<p>SBC checking rank statistics:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ranks_unstructured</span> <span class="op">&lt;-</span> <span class="fu">read_ranks</span><span class="op">(</span><span class="st">"sbc/results/unstructured.fst"</span><span class="op">)</span></span></code></pre></div>
<p>Fixed effect parameter ranks:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ranks_unstructured</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^b_"</span>, <span class="va">parameter</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^b_sigma"</span>, <span class="va">parameter</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">plot_ranks</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="sbc_files/figure-html/unnamed-chunk-12-1.png" width="768">
Log-scale standard deviation parameter ranks:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ranks_unstructured</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"b_sigma"</span>, <span class="va">parameter</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">plot_ranks</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="sbc_files/figure-html/unnamed-chunk-13-1.png" width="768"></p>
<p>Correlation parameter ranks:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ranks_unstructured</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"cortime_"</span>, <span class="va">parameter</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">plot_ranks</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="sbc_files/figure-html/unnamed-chunk-14-1.png" width="768"></p>
</div>
<div class="section level2">
<h2 id="autoregressive-moving-average-scenario">Autoregressive moving average scenario<a class="anchor" aria-label="anchor" href="#autoregressive-moving-average-scenario"></a>
</h2>
<p>This scenario uses an autoregressive moving average (ARMA) model with
autoregressive order 1 and moving average order 1. Assumptions:</p>
<ul>
<li>2 treatment groups</li>
<li>No subgroup</li>
<li>4 time points</li>
<li>50 patients per treatment group</li>
<li>No covariate adjustment</li>
<li>No missing responses</li>
</ul>
<p>Model formula:</p>
<pre><code><span><span class="co">#&gt; response ~ 0 + group + time + arma(time = time, gr = patient, p = 1L, q = 1L, cov = FALSE) </span></span>
<span><span class="co">#&gt; sigma ~ 0 + time</span></span></code></pre>
<p>The prior was randomly generated and used for both simulation and
analysis:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">setup_prior</span><span class="op">(</span><span class="va">autoregressive_moving_average</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">prior</span>, <span class="va">class</span>, <span class="va">coef</span>, <span class="va">dpar</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;                      prior class         coef  dpar</span></span>
<span><span class="co">#&gt; 1        uniform(0.1, 0.9)    ar                   </span></span>
<span><span class="co">#&gt; 3   normal(0.1737, 0.3985)     b groupgroup_1      </span></span>
<span><span class="co">#&gt; 4  normal(-0.1215, 2.1487)     b groupgroup_2      </span></span>
<span><span class="co">#&gt; 5  normal(-0.0756, 2.4499)     b   timetime_2      </span></span>
<span><span class="co">#&gt; 6   normal(-0.0672, 1.454)     b   timetime_3      </span></span>
<span><span class="co">#&gt; 7   normal(0.0282, 1.8807)     b   timetime_4      </span></span>
<span><span class="co">#&gt; 8        uniform(0.1, 0.9)    ma                   </span></span>
<span><span class="co">#&gt; 10   normal(0.101, 1.5519)     b   timetime_1 sigma</span></span>
<span><span class="co">#&gt; 11  normal(0.0335, 0.6042)     b   timetime_2 sigma</span></span>
<span><span class="co">#&gt; 12 normal(-0.0257, 1.3542)     b   timetime_3 sigma</span></span>
<span><span class="co">#&gt; 13 normal(-0.0404, 1.5114)     b   timetime_4 sigma</span></span></code></pre></div>
<p>SBC checking rank statistics:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ranks_autoregressive_moving_average</span> <span class="op">&lt;-</span> <span class="fu">read_ranks</span><span class="op">(</span></span>
<span>  <span class="st">"sbc/results/autoregressive_moving_average.fst"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Fixed effect parameter ranks:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ranks_autoregressive_moving_average</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^b_"</span>, <span class="va">parameter</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^b_sigma"</span>, <span class="va">parameter</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">plot_ranks</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="sbc_files/figure-html/unnamed-chunk-18-1.png" width="768"></p>
<p>Log-scale standard deviation parameter ranks:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ranks_autoregressive_moving_average</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"b_sigma"</span>, <span class="va">parameter</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">plot_ranks</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="sbc_files/figure-html/unnamed-chunk-19-1.png" width="768"></p>
<p>Correlation parameter ranks:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ranks_autoregressive_moving_average</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">parameter</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ar[1]"</span>, <span class="st">"ma[1]"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">plot_ranks</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="sbc_files/figure-html/unnamed-chunk-20-1.png" width="768"></p>
</div>
<div class="section level2">
<h2 id="autoregressive-scenario">Autoregressive scenario<a class="anchor" aria-label="anchor" href="#autoregressive-scenario"></a>
</h2>
<p>This scenario is the same as above, but the correlation structure is
autoregressive with order 2. Model formula:</p>
<pre><code><span><span class="co">#&gt; response ~ 0 + group + time + ar(time = time, gr = patient, p = 2L, cov = FALSE) </span></span>
<span><span class="co">#&gt; sigma ~ 0 + time</span></span></code></pre>
<p>The prior was randomly generated and used for both simulation and
analysis:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">setup_prior</span><span class="op">(</span><span class="va">autoregressive</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">prior</span>, <span class="va">class</span>, <span class="va">coef</span>, <span class="va">dpar</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;                      prior class         coef  dpar</span></span>
<span><span class="co">#&gt; 1        uniform(0.1, 0.9)    ar                   </span></span>
<span><span class="co">#&gt; 3   normal(0.1645, 1.6844)     b groupgroup_1      </span></span>
<span><span class="co">#&gt; 4  normal(-0.1432, 0.3371)     b groupgroup_2      </span></span>
<span><span class="co">#&gt; 5   normal(0.1859, 2.9435)     b   timetime_2      </span></span>
<span><span class="co">#&gt; 6    normal(0.064, 2.2678)     b   timetime_3      </span></span>
<span><span class="co">#&gt; 7   normal(-0.0904, 1.322)     b   timetime_4      </span></span>
<span><span class="co">#&gt; 9    normal(0.135, 1.0282)     b   timetime_1 sigma</span></span>
<span><span class="co">#&gt; 10  normal(0.1832, 1.1802)     b   timetime_2 sigma</span></span>
<span><span class="co">#&gt; 11    normal(0.231, 2.435)     b   timetime_3 sigma</span></span>
<span><span class="co">#&gt; 12 normal(-0.0214, 1.3086)     b   timetime_4 sigma</span></span></code></pre></div>
<p>SBC checking rank statistics:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ranks_autoregressive</span> <span class="op">&lt;-</span> <span class="fu">read_ranks</span><span class="op">(</span><span class="st">"sbc/results/autoregressive.fst"</span><span class="op">)</span></span></code></pre></div>
<p>Fixed effect parameter ranks:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ranks_autoregressive</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^b_"</span>, <span class="va">parameter</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^b_sigma"</span>, <span class="va">parameter</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">plot_ranks</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="sbc_files/figure-html/unnamed-chunk-24-1.png" width="768">
Log-scale standard deviation parameter ranks:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ranks_autoregressive</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"b_sigma"</span>, <span class="va">parameter</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">plot_ranks</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="sbc_files/figure-html/unnamed-chunk-25-1.png" width="768"></p>
<p>Correlation parameter ranks:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ranks_autoregressive</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">parameter</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ar[1]"</span>, <span class="st">"ar[2]"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">plot_ranks</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="sbc_files/figure-html/unnamed-chunk-26-1.png" width="768"></p>
</div>
<div class="section level2">
<h2 id="moving-average-scenario">Moving average scenario<a class="anchor" aria-label="anchor" href="#moving-average-scenario"></a>
</h2>
<p>This scenario is the same as above, but it uses a moving average
correlation structure with order 2. Model formula:</p>
<pre><code><span><span class="co">#&gt; response ~ 0 + group + time + ma(time = time, gr = patient, q = 2L, cov = FALSE) </span></span>
<span><span class="co">#&gt; sigma ~ 0 + time</span></span></code></pre>
<p>The prior was randomly generated and used for both simulation and
analysis:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">setup_prior</span><span class="op">(</span><span class="va">moving_average</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">prior</span>, <span class="va">class</span>, <span class="va">coef</span>, <span class="va">dpar</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;                      prior class         coef  dpar</span></span>
<span><span class="co">#&gt; 2   normal(0.2003, 0.2999)     b groupgroup_1      </span></span>
<span><span class="co">#&gt; 3     normal(0.18, 2.6539)     b groupgroup_2      </span></span>
<span><span class="co">#&gt; 4    normal(0.057, 2.7014)     b   timetime_2      </span></span>
<span><span class="co">#&gt; 5  normal(-0.0733, 0.9602)     b   timetime_3      </span></span>
<span><span class="co">#&gt; 6   normal(0.2424, 2.9937)     b   timetime_4      </span></span>
<span><span class="co">#&gt; 7        uniform(0.1, 0.9)    ma                   </span></span>
<span><span class="co">#&gt; 9   normal(0.1172, 0.4649)     b   timetime_1 sigma</span></span>
<span><span class="co">#&gt; 10 normal(-0.0516, 0.3823)     b   timetime_2 sigma</span></span>
<span><span class="co">#&gt; 11  normal(0.1713, 2.6895)     b   timetime_3 sigma</span></span>
<span><span class="co">#&gt; 12 normal(-0.0965, 0.3201)     b   timetime_4 sigma</span></span></code></pre></div>
<p>SBC checking rank statistics:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ranks_moving_average</span> <span class="op">&lt;-</span> <span class="fu">read_ranks</span><span class="op">(</span><span class="st">"sbc/results/moving_average.fst"</span><span class="op">)</span></span></code></pre></div>
<p>Fixed effect parameter ranks:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ranks_moving_average</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^b_"</span>, <span class="va">parameter</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^b_sigma"</span>, <span class="va">parameter</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">plot_ranks</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="sbc_files/figure-html/unnamed-chunk-30-1.png" width="768">
Log-scale standard deviation parameter ranks:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ranks_moving_average</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"b_sigma"</span>, <span class="va">parameter</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">plot_ranks</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="sbc_files/figure-html/unnamed-chunk-31-1.png" width="768"></p>
<p>Correlation parameter ranks:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ranks_moving_average</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">parameter</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ma[1]"</span>, <span class="st">"ma[2]"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">plot_ranks</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="sbc_files/figure-html/unnamed-chunk-32-1.png" width="768"></p>
</div>
<div class="section level2">
<h2 id="compound-symmetry-scenario">Compound symmetry scenario<a class="anchor" aria-label="anchor" href="#compound-symmetry-scenario"></a>
</h2>
<p>This scenario is the same as above, but it uses a compound symmetry
correlation structure. Model formula:</p>
<pre><code><span><span class="co">#&gt; response ~ 0 + group + time + cosy(time = time, gr = patient) </span></span>
<span><span class="co">#&gt; sigma ~ 0 + time</span></span></code></pre>
<p>The prior was randomly generated and used for both simulation and
analysis:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">setup_prior</span><span class="op">(</span><span class="va">compound_symmetry</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">prior</span>, <span class="va">class</span>, <span class="va">coef</span>, <span class="va">dpar</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;                      prior class         coef  dpar</span></span>
<span><span class="co">#&gt; 2  normal(-0.1482, 1.6958)     b groupgroup_1      </span></span>
<span><span class="co">#&gt; 3   normal(0.0688, 0.4554)     b groupgroup_2      </span></span>
<span><span class="co">#&gt; 4  normal(-0.0271, 1.1727)     b   timetime_2      </span></span>
<span><span class="co">#&gt; 5  normal(-0.0439, 2.5765)     b   timetime_3      </span></span>
<span><span class="co">#&gt; 6  normal(-0.1282, 1.0305)     b   timetime_4      </span></span>
<span><span class="co">#&gt; 7        uniform(0.1, 0.9)  cosy                   </span></span>
<span><span class="co">#&gt; 9   normal(0.2012, 0.7729)     b   timetime_1 sigma</span></span>
<span><span class="co">#&gt; 10 normal(-0.0137, 0.3341)     b   timetime_2 sigma</span></span>
<span><span class="co">#&gt; 11  normal(0.0819, 1.9446)     b   timetime_3 sigma</span></span>
<span><span class="co">#&gt; 12 normal(-0.1519, 1.0543)     b   timetime_4 sigma</span></span></code></pre></div>
<p>SBC checking rank statistics:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ranks_compound_symmetry</span> <span class="op">&lt;-</span> <span class="fu">read_ranks</span><span class="op">(</span><span class="st">"sbc/results/compound_symmetry.fst"</span><span class="op">)</span></span></code></pre></div>
<p>Fixed effect parameter ranks:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ranks_compound_symmetry</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^b_"</span>, <span class="va">parameter</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^b_sigma"</span>, <span class="va">parameter</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">plot_ranks</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="sbc_files/figure-html/unnamed-chunk-36-1.png" width="768">
Log-scale standard deviation parameter ranks:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ranks_compound_symmetry</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"b_sigma"</span>, <span class="va">parameter</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">plot_ranks</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="sbc_files/figure-html/unnamed-chunk-37-1.png" width="768"></p>
<p>Correlation parameter ranks:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ranks_compound_symmetry</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">parameter</span> <span class="op">==</span> <span class="st">"cosy"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">plot_ranks</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="sbc_files/figure-html/unnamed-chunk-38-1.png" width="768"></p>
</div>
<div class="section level2">
<h2 id="diagonal-scenario">Diagonal scenario<a class="anchor" aria-label="anchor" href="#diagonal-scenario"></a>
</h2>
<p>This scenario is the same as above, but it uses a diagonal
correlation structure (independent time points within patients). Model
formula:</p>
<pre><code><span><span class="co">#&gt; response ~ 0 + group + time </span></span>
<span><span class="co">#&gt; sigma ~ group + group:time + time</span></span></code></pre>
<p>The prior was randomly generated and used for both simulation and
analysis:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">setup_prior</span><span class="op">(</span><span class="va">diagonal</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">prior</span>, <span class="va">class</span>, <span class="va">coef</span>, <span class="va">dpar</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;                      prior     class                    coef  dpar</span></span>
<span><span class="co">#&gt; 2   normal(0.1583, 1.5648)         b            groupgroup_1      </span></span>
<span><span class="co">#&gt; 3   normal(0.0025, 1.3794)         b            groupgroup_2      </span></span>
<span><span class="co">#&gt; 4  normal(-0.1174, 2.6911)         b              timetime_2      </span></span>
<span><span class="co">#&gt; 5   normal(0.2088, 1.5977)         b              timetime_3      </span></span>
<span><span class="co">#&gt; 7  normal(-0.0256, 0.7951)         b            groupgroup_2 sigma</span></span>
<span><span class="co">#&gt; 8  normal(-0.0922, 0.6475)         b groupgroup_2:timetime_2 sigma</span></span>
<span><span class="co">#&gt; 9  normal(-0.2232, 0.6214)         b groupgroup_2:timetime_3 sigma</span></span>
<span><span class="co">#&gt; 10  normal(-0.0399, 0.934)         b              timetime_2 sigma</span></span>
<span><span class="co">#&gt; 11  normal(0.1307, 2.6419)         b              timetime_3 sigma</span></span>
<span><span class="co">#&gt; 12  normal(-0.047, 2.4919) Intercept                         sigma</span></span></code></pre></div>
<p>SBC checking rank statistics:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ranks_diagonal</span> <span class="op">&lt;-</span> <span class="fu">read_ranks</span><span class="op">(</span><span class="st">"sbc/results/diagonal.fst"</span><span class="op">)</span></span></code></pre></div>
<p>Fixed effect parameter ranks:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ranks_diagonal</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^b_"</span>, <span class="va">parameter</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^b_sigma"</span>, <span class="va">parameter</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">plot_ranks</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="sbc_files/figure-html/unnamed-chunk-42-1.png" width="768">
Log-scale standard deviation parameter ranks:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ranks_diagonal</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"b_sigma"</span>, <span class="va">parameter</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">plot_ranks</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="sbc_files/figure-html/unnamed-chunk-43-1.png" width="768"></p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-sbc" class="csl-entry">
Kim, S., Moon, H., Modrák, M., and Säilynoja, T. (2022), <em>SBC:
Simulation based calibration for rstan/cmdstanr models</em>.
</div>
<div id="ref-Modrak2024" class="csl-entry">
Modrák, M., Moon, A. H., Kim, S., Bürkner, P., Huurre, N., Faltejsková,
K., Gelman, A., and Vehtari, A. (2024),
<span>“<span>S</span>imulation-<span>B</span>ased
<span>C</span>alibration <span>C</span>hecking for <span>B</span>ayesian
<span>C</span>omputation: <span>T</span>he <span>C</span>hoice of
<span>T</span>est <span>Q</span>uantities <span>S</span>hapes
<span>S</span>ensitivity,”</span> <em>Bayesian Analysis</em>,
forthcoming. <a href="https://doi.org/10.1214/23-BA1404" class="external-link">https://doi.org/10.1214/23-BA1404</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by William Michael Landau, Kevin Kunzmann, Yoni Sidi, Christian Stock, Eli Lilly and Company, Boehringer Ingelheim Pharma GmbH &amp; Co. KG.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
